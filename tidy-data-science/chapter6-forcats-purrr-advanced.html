<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬6ç« : forcats & purrr - å› å­ã¨ãƒªã‚¹ãƒˆæ“ä½œ | Tidyverseå®Œå…¨ãƒã‚¹ã‚¿ãƒ¼</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-neon: #00ff88;
            --accent-cyan: #00d4ff;
            --accent-purple: #9d4edd;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-neon: #00ff88;
            --shadow-neon: 0 0 20px #00ff8840;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(45deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 20px;
            border: 2px solid var(--accent-neon);
            box-shadow: var(--shadow-neon);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-neon);
            margin-bottom: 10px;
            text-shadow: 0 0 20px var(--accent-neon);
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.4rem;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 2px solid var(--text-secondary);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--accent-neon);
            border-color: var(--accent-neon);
            box-shadow: 0 0 10px var(--accent-neon);
        }

        .progress-dot.completed {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
        }

        /* Navigation Widget */
        .chapter-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 15px;
            border: 1px solid var(--accent-neon);
            width: fit-content;
            max-width: 90vw;
            margin-left: auto;
            margin-right: auto;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            border: 1px solid var(--accent-cyan);
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .nav-button:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            box-shadow: 0 0 15px var(--accent-cyan);
            transform: translateY(-2px);
        }

        .nav-button.current {
            background: var(--accent-neon);
            color: var(--bg-primary);
            box-shadow: 0 0 15px var(--accent-neon);
        }

        /* Content Sections */
        .section {
            background: var(--bg-secondary);
            margin: 30px 0;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--accent-purple);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-neon), var(--accent-cyan), var(--accent-purple));
            border-radius: 15px 15px 0 0;
        }

        h2 {
            color: var(--accent-neon);
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--accent-neon);
        }

        h3 {
            color: var(--accent-cyan);
            font-size: 1.5rem;
            margin: 25px 0 15px 0;
            text-shadow: 0 0 8px var(--accent-cyan);
        }

        h4 {
            color: var(--accent-purple);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        /* Code Blocks */
        .code-container {
            margin: 20px 0;
            background: #1a1a1a;
            border-radius: 10px;
            border: 1px solid var(--accent-neon);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.1);
        }

        .code-header {
            background: var(--accent-neon);
            color: var(--bg-primary);
            padding: 10px 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .code-header::before {
            content: 'âš¡';
            font-size: 1.1rem;
        }

        .code-content {
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            background: #0d1117;
            color: #c9d1d9;
            overflow-x: auto;
        }

        /* Syntax highlighting */
        .keyword { color: #ff7b72; }
        .function { color: #d2a8ff; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .operator { color: #f85149; }
        .number { color: #79c0ff; }
        .variable { color: #ffa657; }

        /* Output Display */
        .output-container {
            margin: 20px 0;
            background: #0a0e1a;
            border-radius: 10px;
            border: 1px solid var(--accent-cyan);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.1);
        }

        .output-header {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            padding: 10px 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .output-header::before {
            content: 'ğŸ“Š';
        }

        .output-content {
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--accent-cyan);
        }

        /* Data Visualization */
        .visualization {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--accent-purple);
            text-align: center;
        }

        .viz-title {
            color: var(--accent-purple);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: bold;
        }

        /* Data Tables */
        .data-table {
            margin: 20px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--accent-neon);
        }

        th {
            background: var(--accent-neon);
            color: var(--bg-primary);
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--bg-secondary);
            color: var(--text-primary);
        }

        tr:nth-child(even) {
            background: rgba(0, 255, 136, 0.05);
        }

        tr:hover {
            background: rgba(0, 255, 136, 0.1);
        }

        /* Key Points */
        .key-points {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 212, 255, 0.1) 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-neon);
        }

        .key-points h4 {
            color: var(--accent-neon);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .key-points h4::before {
            content: 'ğŸ’¡';
        }

        .key-points ul {
            list-style: none;
            padding-left: 0;
        }

        .key-points li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .key-points li::before {
            content: 'â–¶';
            color: var(--accent-cyan);
            position: absolute;
            left: 0;
        }

        /* Warning/Tip boxes */
        .tip-box {
            background: rgba(157, 78, 221, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-purple);
        }

        .tip-box h4 {
            color: var(--accent-purple);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-box h4::before {
            content: 'âš ï¸';
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }

            .chapter-meta {
                flex-direction: column;
                gap: 10px;
            }

            .chapter-nav {
                gap: 8px;
                padding: 10px;
            }

            .nav-button {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .section {
                padding: 20px;
                margin: 20px 0;
            }

            h2 {
                font-size: 1.5rem;
            }

            .code-content, .output-content {
                font-size: 0.85rem;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .chapter-nav {
                flex-direction: column;
                gap: 8px;
            }

            .nav-button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç¬¬6ç« : forcats & purrr</h1>
            <p class="subtitle">å› å­ã¨ãƒªã‚¹ãƒˆæ“ä½œã®é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</p>
            <div class="chapter-meta">
                <span>ğŸ“Š å› å­ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œ</span>
                <span>ğŸ”„ é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</span>
                <span>ğŸ“ˆ ãƒã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å‡¦ç†</span>
            </div>
            <div class="progress-indicator">
                <div class="progress-dot completed"></div>
                <div class="progress-dot completed"></div>
                <div class="progress-dot completed"></div>
                <div class="progress-dot completed"></div>
                <div class="progress-dot completed"></div>
                <div class="progress-dot active"></div>
            </div>
        </header>

        <nav class="chapter-nav">
            <a href="chapter1-tidyverse-overview.html" class="nav-button">ç¬¬1ç« </a>
            <a href="chapter2-dplyr-data-manipulation.html" class="nav-button">ç¬¬2ç« </a>
            <a href="chapter3-ggplot2-visualization.html" class="nav-button">ç¬¬3ç« </a>
            <a href="chapter4-tidyr-data-reshaping.html" class="nav-button">ç¬¬4ç« </a>
            <a href="chapter5-stringr-text-processing.html" class="nav-button">ç¬¬5ç« </a>
            <a href="#" class="nav-button current">ç¬¬6ç« </a>
        </nav>

        <section class="section">
            <h2>ğŸ¯ forcats: å› å­ãƒ‡ãƒ¼ã‚¿ã®è‡ªåœ¨ãªæ“ä½œ</h2>
            
            <p>forcatsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€Rã®å› å­ï¼ˆfactorï¼‰ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å› å­ã¯é †åºã®ã‚ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¾ã™ã‚‹ã®ã«é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚</p>

            <h3>åŸºæœ¬çš„ãªå› å­æ“ä½œ</h3>

            <div class="code-container">
                <div class="code-header">å› å­ã®ä½œæˆã¨ãƒ¬ãƒ™ãƒ«æ“ä½œ</div>
                <div class="code-content">
<span class="keyword">library</span>(<span class="string">forcats</span>)
<span class="keyword">library</span>(<span class="string">dplyr</span>)

<span class="comment"># åŸºæœ¬çš„ãªå› å­ã®ä½œæˆ</span>
satisfaction <span class="operator">&lt;-</span> <span class="function">factor</span>(<span class="function">c</span>(<span class="string">"æº€è¶³"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"ä¸æº€"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>, <span class="string">"æ™®é€š"</span>))
<span class="function">levels</span>(satisfaction)

<span class="comment"># fct_relevel()ã§ãƒ¬ãƒ™ãƒ«ã®é †åºã‚’æŒ‡å®š</span>
satisfaction_ordered <span class="operator">&lt;-</span> <span class="function">fct_relevel</span>(satisfaction, 
  <span class="string">"éå¸¸ã«æº€è¶³"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"ä¸æº€"</span>)
<span class="function">levels</span>(satisfaction_ordered)

<span class="comment"># fct_infreq()ã§é »åº¦é †ã«ä¸¦ã³æ›¿ãˆ</span>
satisfaction_freq <span class="operator">&lt;-</span> <span class="function">fct_infreq</span>(satisfaction)
<span class="function">levels</span>(satisfaction_freq)
</div>
            </div>

            <div class="output-container">
                <div class="output-header">å®Ÿè¡Œçµæœ</div>
                <div class="output-content">[1] "ä¸æº€"     "æ™®é€š"     "æº€è¶³"     "éå¸¸ã«æº€è¶³"

[1] "éå¸¸ã«æº€è¶³" "æº€è¶³"       "æ™®é€š"       "ä¸æº€"

[1] "æ™®é€š" "æº€è¶³" "ä¸æº€" "éå¸¸ã«æº€è¶³"</div>
            </div>

            <h3>å› å­ãƒ¬ãƒ™ãƒ«ã®çµ±åˆã¨å†ã‚³ãƒ¼ãƒ‰åŒ–</h3>

            <div class="code-container">
                <div class="code-header">ãƒ¬ãƒ™ãƒ«ã®çµ±åˆã¨ãƒªã‚³ãƒ¼ãƒ‰</div>
                <div class="code-content">
<span class="comment"># ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</span>
products <span class="operator">&lt;-</span> <span class="function">factor</span>(<span class="function">c</span>(<span class="string">"ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³"</span>, <span class="string">"ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ"</span>, <span class="string">"ãƒãƒ¼ãƒˆPC"</span>, <span class="string">"ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—PC"</span>, 
                      <span class="string">"ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³"</span>, <span class="string">"ãã®ä»–"</span>, <span class="string">"ã‚¢ã‚¯ã‚»ã‚µãƒª"</span>, <span class="string">"ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ"</span>))

<span class="comment"># fct_collapse()ã§ã‚«ãƒ†ã‚´ãƒªã‚’çµ±åˆ</span>
products_grouped <span class="operator">&lt;-</span> <span class="function">fct_collapse</span>(products,
  <span class="string">"ãƒ¢ãƒã‚¤ãƒ«æ©Ÿå™¨"</span> <span class="operator">=</span> <span class="function">c</span>(<span class="string">"ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³"</span>, <span class="string">"ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ"</span>),
  <span class="string">"PC"</span> <span class="operator">=</span> <span class="function">c</span>(<span class="string">"ãƒãƒ¼ãƒˆPC"</span>, <span class="string">"ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—PC"</span>),
  <span class="string">"ãã®ä»–"</span> <span class="operator">=</span> <span class="function">c</span>(<span class="string">"ãã®ä»–"</span>, <span class="string">"ã‚¢ã‚¯ã‚»ã‚µãƒª"</span>)
)

<span class="function">table</span>(products_grouped)

<span class="comment"># fct_recode()ã§å€‹åˆ¥ã«ãƒªã‚³ãƒ¼ãƒ‰</span>
satisfaction_jp <span class="operator">&lt;-</span> <span class="function">factor</span>(<span class="function">c</span>(<span class="string">"excellent"</span>, <span class="string">"good"</span>, <span class="string">"fair"</span>, <span class="string">"poor"</span>))
satisfaction_recoded <span class="operator">&lt;-</span> <span class="function">fct_recode</span>(satisfaction_jp,
  <span class="string">"å„ªç§€"</span> <span class="operator">=</span> <span class="string">"excellent"</span>,
  <span class="string">"è‰¯å¥½"</span> <span class="operator">=</span> <span class="string">"good"</span>,
  <span class="string">"æ™®é€š"</span> <span class="operator">=</span> <span class="string">"fair"</span>,
  <span class="string">"ä¸è‰¯"</span> <span class="operator">=</span> <span class="string">"poor"</span>
)

<span class="function">levels</span>(satisfaction_recoded)
</div>
            </div>

            <div class="output-container">
                <div class="output-header">çµ±åˆçµæœ</div>
                <div class="output-content">products_grouped
   ãƒ¢ãƒã‚¤ãƒ«æ©Ÿå™¨            PC        ãã®ä»– 
            3             2             3 

[1] "å„ªç§€" "è‰¯å¥½" "æ™®é€š" "ä¸è‰¯"</div>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ² purrr: é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å¨åŠ›</h2>
            
            <p>purrrãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ãƒªã‚¹ãƒˆã‚„ãƒ™ã‚¯ãƒˆãƒ«ã«å¯¾ã™ã‚‹é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®æ‰‹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚mapé–¢æ•°ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã‚’ä½¿ã£ã¦ã€åŠ¹ç‡çš„ãªåå¾©å‡¦ç†ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚</p>

            <h3>mapé–¢æ•°ã®åŸºæœ¬ä½¿ç”¨æ³•</h3>

            <div class="code-container">
                <div class="code-header">mapé–¢æ•°ãƒ•ã‚¡ãƒŸãƒªãƒ¼ã®åŸºæœ¬</div>
                <div class="code-content">
<span class="keyword">library</span>(<span class="string">purrr</span>)

<span class="comment"># æ•°å€¤ãƒªã‚¹ãƒˆã®ä½œæˆ</span>
numbers <span class="operator">&lt;-</span> <span class="function">list</span>(<span class="function">c</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), <span class="function">c</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>), <span class="function">c</span>(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>))

<span class="comment"># map()ã§å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨</span>
sums <span class="operator">&lt;-</span> <span class="function">map</span>(numbers, sum)
<span class="function">str</span>(sums)

<span class="comment"># map_dbl()ã§æ•°å€¤ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¿”ã™</span>
sums_numeric <span class="operator">&lt;-</span> <span class="function">map_dbl</span>(numbers, sum)
sums_numeric

<span class="comment"># map_chr()ã§æ–‡å­—ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¿”ã™</span>
lengths_char <span class="operator">&lt;-</span> <span class="function">map_chr</span>(numbers, ~ <span class="function">paste</span>(<span class="string">"é•·ã•:"</span>, <span class="function">length</span>(.x)))
lengths_char

<span class="comment"># è¤‡é›‘ãªé–¢æ•°ã®é©ç”¨</span>
stats <span class="operator">&lt;-</span> <span class="function">map</span>(numbers, ~ <span class="function">list</span>(
  mean <span class="operator">=</span> <span class="function">mean</span>(.x),
  sd <span class="operator">=</span> <span class="function">sd</span>(.x),
  range <span class="operator">=</span> <span class="function">range</span>(.x)
))
stats
</div>
            </div>

            <div class="output-container">
                <div class="output-header">mapå®Ÿè¡Œçµæœ</div>
                <div class="output-content">List of 3
 $ : int 6
 $ : int 15
 $ : int 24

[1]  6 15 24

[1] "é•·ã•: 3" "é•·ã•: 3" "é•·ã•: 3"

[[1]]
[[1]]$mean
[1] 2

[[1]]$sd
[1] 1

[[1]]$range
[1] 1 3

[[2]]
[[2]]$mean
[1] 5

[[2]]$sd
[1] 1

[[2]]$range
[1] 4 6</div>
            </div>

            <h3>ãƒã‚¹ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®å‡¦ç†</h3>

            <div class="code-container">
                <div class="code-header">ãƒã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨purrr</div>
                <div class="code-content">
<span class="keyword">library</span>(<span class="string">tidyr</span>)

<span class="comment"># ã‚µãƒ³ãƒ—ãƒ«ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿</span>
sales_data <span class="operator">&lt;-</span> <span class="function">tibble</span>(
  store <span class="operator">=</span> <span class="function">rep</span>(<span class="function">c</span>(<span class="string">"Store_A"</span>, <span class="string">"Store_B"</span>, <span class="string">"Store_C"</span>), each <span class="operator">=</span> <span class="number">12</span>),
  month <span class="operator">=</span> <span class="function">rep</span>(<span class="number">1</span>:<span class="number">12</span>, <span class="number">3</span>),
  sales <span class="operator">=</span> <span class="function">c</span>(<span class="function">rnorm</span>(<span class="number">12</span>, <span class="number">100</span>, <span class="number">20</span>), <span class="function">rnorm</span>(<span class="number">12</span>, <span class="number">150</span>, <span class="number">30</span>), <span class="function">rnorm</span>(<span class="number">12</span>, <span class="number">80</span>, <span class="number">15</span>))
)

<span class="comment"># åº—èˆ—ã”ã¨ã«ãƒã‚¹ãƒˆ</span>
nested_sales <span class="operator">&lt;-</span> sales_data <span class="operator">%&gt;%</span>
  <span class="function">group_by</span>(store) <span class="operator">%&gt;%</span>
  <span class="function">nest</span>()

<span class="function">print</span>(nested_sales)

<span class="comment"># å„åº—èˆ—ã®çµ±è¨ˆé‡ã‚’è¨ˆç®—</span>
store_stats <span class="operator">&lt;-</span> nested_sales <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    stats <span class="operator">=</span> <span class="function">map</span>(data, ~ <span class="function">list</span>(
      mean_sales <span class="operator">=</span> <span class="function">mean</span>(.x$sales),
      total_sales <span class="operator">=</span> <span class="function">sum</span>(.x$sales),
      peak_month <span class="operator">=</span> .x$month[<span class="function">which.max</span>(.x$sales)]
    ))
  )

<span class="comment"># çµ±è¨ˆæƒ…å ±ã‚’å±•é–‹</span>
store_summary <span class="operator">&lt;-</span> store_stats <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    mean_sales <span class="operator">=</span> <span class="function">map_dbl</span>(stats, ~ .x$mean_sales),
    total_sales <span class="operator">=</span> <span class="function">map_dbl</span>(stats, ~ .x$total_sales),
    peak_month <span class="operator">=</span> <span class="function">map_dbl</span>(stats, ~ .x$peak_month)
  ) <span class="operator">%&gt;%</span>
  <span class="function">select</span>(store, mean_sales, total_sales, peak_month)

<span class="function">print</span>(store_summary)
</div>
            </div>

            <div class="output-container">
                <div class="output-header">ãƒã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å‡¦ç†çµæœ</div>
                <div class="output-content"># A tibble: 3 Ã— 2
  store   data             
  &lt;chr&gt;   &lt;list&gt;           
1 Store_A &lt;tibble [12 Ã— 2]&gt;
2 Store_B &lt;tibble [12 Ã— 2]&gt;
3 Store_C &lt;tibble [12 Ã— 2]&gt;

# A tibble: 3 Ã— 4
  store   mean_sales total_sales peak_month
  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1 Store_A       98.3       1180.          8
2 Store_B      148.        1776.          5
3 Store_C       79.4        953.         11</div>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“Š å®Ÿè·µçš„ãªå› å­æ“ä½œ: é¡§å®¢æº€è¶³åº¦åˆ†æ</h2>

            <div class="code-container">
                <div class="code-header">é¡§å®¢æº€è¶³åº¦ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†</div>
                <div class="code-content">
<span class="comment"># é¡§å®¢æº€è¶³åº¦èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ</span>
<span class="function">set.seed</span>(<span class="number">123</span>)
customer_survey <span class="operator">&lt;-</span> <span class="function">tibble</span>(
  customer_id <span class="operator">=</span> <span class="number">1</span>:<span class="number">1000</span>,
  age_group <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"18-25"</span>, <span class="string">"26-35"</span>, <span class="string">"36-45"</span>, <span class="string">"46-55"</span>, <span class="string">"56+"</span>), <span class="number">1000</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>),
  satisfaction <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"éå¸¸ã«ä¸æº€"</span>, <span class="string">"ä¸æº€"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>), 
                        <span class="number">1000</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>, 
                        prob <span class="operator">=</span> <span class="function">c</span>(<span class="number">0.05</span>, <span class="number">0.15</span>, <span class="number">0.3</span>, <span class="number">0.35</span>, <span class="number">0.15</span>)),
  product_type <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"é›»å­æ©Ÿå™¨"</span>, <span class="string">"è¡£æ–™å“"</span>, <span class="string">"é£Ÿå“"</span>, <span class="string">"æ›¸ç±"</span>, <span class="string">"ã‚¹ãƒãƒ¼ãƒ„ç”¨å“"</span>), 
                          <span class="number">1000</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>)
)

<span class="comment"># å› å­ã®é †åºã‚’é©åˆ‡ã«è¨­å®š</span>
customer_survey <span class="operator">&lt;-</span> customer_survey <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    age_group <span class="operator">=</span> <span class="function">fct_relevel</span>(age_group, <span class="string">"18-25"</span>, <span class="string">"26-35"</span>, <span class="string">"36-45"</span>, <span class="string">"46-55"</span>, <span class="string">"56+"</span>),
    satisfaction <span class="operator">=</span> <span class="function">fct_relevel</span>(satisfaction, <span class="string">"éå¸¸ã«ä¸æº€"</span>, <span class="string">"ä¸æº€"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>)
  )

<span class="comment"># å¹´ä»£åˆ¥æº€è¶³åº¦ã®é›†è¨ˆ</span>
age_satisfaction <span class="operator">&lt;-</span> customer_survey <span class="operator">%&gt;%</span>
  <span class="function">count</span>(age_group, satisfaction) <span class="operator">%&gt;%</span>
  <span class="function">group_by</span>(age_group) <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(percentage <span class="operator">=</span> n / <span class="function">sum</span>(n) <span class="operator">*</span> <span class="number">100</span>)

<span class="function">print</span>(age_satisfaction)

<span class="comment"># æº€è¶³åº¦ã‚’3æ®µéšã«çµ±åˆ</span>
customer_survey_simplified <span class="operator">&lt;-</span> customer_survey <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    satisfaction_simple <span class="operator">=</span> <span class="function">fct_collapse</span>(satisfaction,
      <span class="string">"ä¸æº€"</span> <span class="operator">=</span> <span class="function">c</span>(<span class="string">"éå¸¸ã«ä¸æº€"</span>, <span class="string">"ä¸æº€"</span>),
      <span class="string">"æ™®é€š"</span> <span class="operator">=</span> <span class="string">"æ™®é€š"</span>,
      <span class="string">"æº€è¶³"</span> <span class="operator">=</span> <span class="function">c</span>(<span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>)
    )
  )

<span class="comment"># è£½å“ã‚¿ã‚¤ãƒ—åˆ¥ã®æº€è¶³åº¦ï¼ˆç°¡ç•¥ç‰ˆï¼‰</span>
product_satisfaction <span class="operator">&lt;-</span> customer_survey_simplified <span class="operator">%&gt;%</span>
  <span class="function">count</span>(product_type, satisfaction_simple) <span class="operator">%&gt;%</span>
  <span class="function">group_by</span>(product_type) <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(percentage <span class="operator">=</span> <span class="function">round</span>(n / <span class="function">sum</span>(n) <span class="operator">*</span> <span class="number">100</span>, <span class="number">1</span>))

<span class="function">print</span>(product_satisfaction)
</div>
            </div>

            <div class="visualization">
                <div class="viz-title">å¹´ä»£åˆ¥æº€è¶³åº¦åˆ†æçµæœ</div>
                <svg width="600" height="300" viewBox="0 0 600 300">
                    <!-- Background -->
                    <rect width="600" height="300" fill="#1a1a1a" stroke="#00ff88" stroke-width="1"/>
                    
                    <!-- Title -->
                    <text x="300" y="25" text-anchor="middle" fill="#00ff88" font-size="16" font-weight="bold">å¹´ä»£åˆ¥æº€è¶³åº¦åˆ†å¸ƒ</text>
                    
                    <!-- Age groups bars -->
                    <!-- 18-25 -->
                    <rect x="50" y="50" width="30" height="60" fill="#ff7b72" opacity="0.8"/>
                    <rect x="50" y="110" width="30" height="80" fill="#ffa657" opacity="0.8"/>
                    <rect x="50" y="190" width="30" height="40" fill="#00ff88" opacity="0.8"/>
                    
                    <!-- 26-35 -->
                    <rect x="130" y="60" width="30" height="50" fill="#ff7b72" opacity="0.8"/>
                    <rect x="130" y="110" width="30" height="90" fill="#ffa657" opacity="0.8"/>
                    <rect x="130" y="200" width="30" height="30" fill="#00ff88" opacity="0.8"/>
                    
                    <!-- 36-45 -->
                    <rect x="210" y="70" width="30" height="40" fill="#ff7b72" opacity="0.8"/>
                    <rect x="210" y="110" width="30" height="70" fill="#ffa657" opacity="0.8"/>
                    <rect x="210" y="180" width="30" height="50" fill="#00ff88" opacity="0.8"/>
                    
                    <!-- 46-55 -->
                    <rect x="290" y="80" width="30" height="30" fill="#ff7b72" opacity="0.8"/>
                    <rect x="290" y="110" width="30" height="60" fill="#ffa657" opacity="0.8"/>
                    <rect x="290" y="170" width="30" height="60" fill="#00ff88" opacity="0.8"/>
                    
                    <!-- 56+ -->
                    <rect x="370" y="90" width="30" height="20" fill="#ff7b72" opacity="0.8"/>
                    <rect x="370" y="110" width="30" height="50" fill="#ffa657" opacity="0.8"/>
                    <rect x="370" y="160" width="30" height="70" fill="#00ff88" opacity="0.8"/>
                    
                    <!-- Labels -->
                    <text x="65" y="250" text-anchor="middle" fill="#b3b3b3" font-size="10">18-25</text>
                    <text x="145" y="250" text-anchor="middle" fill="#b3b3b3" font-size="10">26-35</text>
                    <text x="225" y="250" text-anchor="middle" fill="#b3b3b3" font-size="10">36-45</text>
                    <text x="305" y="250" text-anchor="middle" fill="#b3b3b3" font-size="10">46-55</text>
                    <text x="385" y="250" text-anchor="middle" fill="#b3b3b3" font-size="10">56+</text>
                    
                    <!-- Legend -->
                    <rect x="450" y="70" width="15" height="15" fill="#ff7b72" opacity="0.8"/>
                    <text x="470" y="82" fill="#b3b3b3" font-size="12">ä¸æº€</text>
                    <rect x="450" y="95" width="15" height="15" fill="#ffa657" opacity="0.8"/>
                    <text x="470" y="107" fill="#b3b3b3" font-size="12">æ™®é€š</text>
                    <rect x="450" y="120" width="15" height="15" fill="#00ff88" opacity="0.8"/>
                    <text x="470" y="132" fill="#b3b3b3" font-size="12">æº€è¶³</text>
                </svg>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ”„ é«˜åº¦ãªpurrræ´»ç”¨: è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ä¸€æ‹¬å‡¦ç†</h2>

            <div class="code-container">
                <div class="code-header">è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€æ‹¬èª­ã¿è¾¼ã¿ã¨å‡¦ç†</div>
                <div class="code-content">
<span class="comment"># è¤‡æ•°ã®æœˆæ¬¡å£²ä¸Šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¨ä»®å®š</span>
<span class="comment"># ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ</span>
file_names <span class="operator">&lt;-</span> <span class="function">paste0</span>(<span class="string">"sales_"</span>, <span class="number">2023</span>, <span class="string">"_"</span>, <span class="function">sprintf</span>(<span class="string">"%02d"</span>, <span class="number">1</span>:<span class="number">12</span>), <span class="string">".csv"</span>)

<span class="comment"># ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹é–¢æ•°</span>
create_monthly_data <span class="operator">&lt;-</span> <span class="keyword">function</span>(month) {
  <span class="function">tibble</span>(
    month <span class="operator">=</span> month,
    product <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"Product_A"</span>, <span class="string">"Product_B"</span>, <span class="string">"Product_C"</span>), <span class="number">100</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>),
    sales <span class="operator">=</span> <span class="function">rnorm</span>(<span class="number">100</span>, <span class="number">1000</span> <span class="operator">+</span> month <span class="operator">*</span> <span class="number">50</span>, <span class="number">200</span>),
    region <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"åŒ—æµ·é“"</span>, <span class="string">"é–¢æ±"</span>, <span class="string">"é–¢è¥¿"</span>, <span class="string">"ä¹å·"</span>), <span class="number">100</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>)
  )
}

<span class="comment"># map()ã‚’ä½¿ã£ã¦å…¨æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
monthly_data_list <span class="operator">&lt;-</span> <span class="function">map</span>(<span class="number">1</span>:<span class="number">12</span>, create_monthly_data)
<span class="function">names</span>(monthly_data_list) <span class="operator">&lt;-</span> <span class="function">paste0</span>(<span class="string">"Month_"</span>, <span class="number">1</span>:<span class="number">12</span>)

<span class="comment"># å„æœˆã®çµ±è¨ˆã‚’è¨ˆç®—</span>
monthly_stats <span class="operator">&lt;-</span> <span class="function">map_dfr</span>(monthly_data_list, ~ {
  .x <span class="operator">%&gt;%</span>
    <span class="function">summarise</span>(
      total_sales <span class="operator">=</span> <span class="function">sum</span>(sales),
      avg_sales <span class="operator">=</span> <span class="function">mean</span>(sales),
      transactions <span class="operator">=</span> <span class="function">n</span>(),
      unique_products <span class="operator">=</span> <span class="function">n_distinct</span>(product)
    )
}, .id <span class="operator">=</span> <span class="string">"month"</span>)

<span class="function">print</span>(monthly_stats)

<span class="comment"># åœ°åŸŸåˆ¥åˆ†æã‚’å„æœˆã«å¯¾ã—ã¦å®Ÿè¡Œ</span>
regional_analysis <span class="operator">&lt;-</span> <span class="function">map</span>(monthly_data_list, ~ {
  .x <span class="operator">%&gt;%</span>
    <span class="function">group_by</span>(region) <span class="operator">%&gt;%</span>
    <span class="function">summarise</span>(
      total_sales <span class="operator">=</span> <span class="function">sum</span>(sales),
      avg_sales <span class="operator">=</span> <span class="function">mean</span>(sales),
      transactions <span class="operator">=</span> <span class="function">n</span>(),
      .groups <span class="operator">=</span> <span class="string">'drop'</span>
    )
})

<span class="comment"># é–¢æ±åœ°åŸŸã®æœˆæ¬¡æ¨ç§»ã‚’æŠ½å‡º</span>
kanto_trend <span class="operator">&lt;-</span> <span class="function">map_dfr</span>(regional_analysis, ~ {
  .x <span class="operator">%&gt;%</span> <span class="function">filter</span>(region <span class="operator">==</span> <span class="string">"é–¢æ±"</span>)
}, .id <span class="operator">=</span> <span class="string">"month"</span>)

<span class="function">print</span>(kanto_trend)
</div>
            </div>

            <div class="output-container">
                <div class="output-header">ä¸€æ‹¬å‡¦ç†çµæœ</div>
                <div class="output-content"># A tibble: 12 Ã— 5
   month   total_sales avg_sales transactions unique_products
   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;        &lt;int&gt;           &lt;int&gt;
 1 Month_1     104539.     1045.          100               3
 2 Month_2     109876.     1099.          100               3
 3 Month_3     115234.     1152.          100               3
 4 Month_4     120512.     1205.          100               3
 5 Month_5     125798.     1258.          100               3
 6 Month_6     131067.     1311.          100               3

# A tibble: 12 Ã— 4
   month   region total_sales avg_sales transactions
   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;        &lt;int&gt;
 1 Month_1 é–¢æ±        26789.     1115.           24
 2 Month_2 é–¢æ±        28156.     1173.           24
 3 Month_3 é–¢æ±        29523.     1230.           24
 4 Month_4 é–¢æ±        30890.     1287.           24</div>
            </div>

            <h3>æ¡ä»¶åˆ†å²ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h3>

            <div class="code-container">
                <div class="code-header">safely()ã¨possibly()ã®æ´»ç”¨</div>
                <div class="code-content">
<span class="comment"># ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹é–¢æ•°</span>
risky_calculation <span class="operator">&lt;-</span> <span class="keyword">function</span>(x) {
  <span class="keyword">if</span> (x <span class="operator">&lt;</span> <span class="number">0</span>) {
    <span class="function">stop</span>(<span class="string">"è² ã®å€¤ã¯è¨ˆç®—ã§ãã¾ã›ã‚“"</span>)
  }
  <span class="function">sqrt</span>(x) <span class="operator">+</span> <span class="function">log</span>(x)
}

<span class="comment"># ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆè² ã®å€¤ã‚’å«ã‚€ï¼‰</span>
test_values <span class="operator">&lt;-</span> <span class="function">c</span>(<span class="number">4</span>, <span class="number">9</span>, <span class="number">-2</span>, <span class="number">16</span>, <span class="number">-5</span>, <span class="number">25</span>)

<span class="comment"># safely()ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ</span>
safe_calculation <span class="operator">&lt;-</span> <span class="function">safely</span>(risky_calculation)
results <span class="operator">&lt;-</span> <span class="function">map</span>(test_values, safe_calculation)

<span class="comment"># æˆåŠŸã—ãŸçµæœã®ã¿ã‚’æŠ½å‡º</span>
successful_results <span class="operator">&lt;-</span> <span class="function">map</span>(results, <span class="string">"result"</span>) <span class="operator">%&gt;%</span>
  <span class="function">keep</span>(~ !<span class="function">is.null</span>(.x))

<span class="function">print</span>(successful_results)

<span class="comment"># ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ½å‡º</span>
error_messages <span class="operator">&lt;-</span> <span class="function">map</span>(results, <span class="string">"error"</span>) <span class="operator">%&gt;%</span>
  <span class="function">keep</span>(~ !<span class="function">is.null</span>(.x))

<span class="function">print</span>(error_messages)

<span class="comment"># possibly()ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®š</span>
safe_calc_with_default <span class="operator">&lt;-</span> <span class="function">possibly</span>(risky_calculation, otherwise <span class="operator">=</span> <span class="number">NA</span>)
clean_results <span class="operator">&lt;-</span> <span class="function">map_dbl</span>(test_values, safe_calc_with_default)

<span class="function">print</span>(clean_results)
</div>
            </div>

            <div class="output-container">
                <div class="output-header">ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµæœ</div>
                <div class="output-content">[[1]]
[1] 3.386294

[[2]]
[1] 5.197225

[[3]]
[1] 6.772589

[[1]]
&lt;simpleError in risky_calculation(-2): è² ã®å€¤ã¯è¨ˆç®—ã§ãã¾ã›ã‚“&gt;

[[2]]
&lt;simpleError in risky_calculation(-5): è² ã®å€¤ã¯è¨ˆç®—ã§ãã¾ã›ã‚“&gt;

[1] 3.386294 5.197225       NA 6.772589       NA 8.218876</div>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ¯ å®Ÿè·µæ¼”ç¿’: ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆçµæœã®åŒ…æ‹¬çš„åˆ†æ</h2>

            <div class="code-container">
                <div class="code-header">çµ±åˆçš„ãªãƒ‡ãƒ¼ã‚¿åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</div>
                <div class="code-content">
<span class="comment"># è¤‡æ•°ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆèª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆåˆ†æ</span>
<span class="function">set.seed</span>(<span class="number">456</span>)

<span class="comment"># è¤‡æ•°ã®èª¿æŸ»æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
survey_periods <span class="operator">&lt;-</span> <span class="function">c</span>(<span class="string">"2023Q1"</span>, <span class="string">"2023Q2"</span>, <span class="string">"2023Q3"</span>, <span class="string">"2023Q4"</span>)

create_survey_data <span class="operator">&lt;-</span> <span class="keyword">function</span>(period) {
  <span class="function">tibble</span>(
    period <span class="operator">=</span> period,
    respondent_id <span class="operator">=</span> <span class="number">1</span>:<span class="number">500</span>,
    age_group <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"20ä»£"</span>, <span class="string">"30ä»£"</span>, <span class="string">"40ä»£"</span>, <span class="string">"50ä»£"</span>, <span class="string">"60ä»£ä»¥ä¸Š"</span>), 
                          <span class="number">500</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>),
    service_satisfaction <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"éå¸¸ã«ä¸æº€"</span>, <span class="string">"ä¸æº€"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>),
                                   <span class="number">500</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>, 
                                   prob <span class="operator">=</span> <span class="function">c</span>(<span class="number">0.05</span>, <span class="number">0.1</span>, <span class="number">0.25</span>, <span class="number">0.45</span>, <span class="number">0.15</span>)),
    price_satisfaction <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"é«˜ã™ãã‚‹"</span>, <span class="string">"ã‚„ã‚„é«˜ã„"</span>, <span class="string">"é©æ­£"</span>, <span class="string">"ã‚„ã‚„å®‰ã„"</span>, <span class="string">"å®‰ã„"</span>),
                               <span class="number">500</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>,
                               prob <span class="operator">=</span> <span class="function">c</span>(<span class="number">0.15</span>, <span class="number">0.25</span>, <span class="number">0.4</span>, <span class="number">0.15</span>, <span class="number">0.05</span>)),
    recommendation <span class="operator">=</span> <span class="function">sample</span>(<span class="function">c</span>(<span class="string">"å…¨ãæ¨å¥¨ã—ãªã„"</span>, <span class="string">"æ¨å¥¨ã—ãªã„"</span>, <span class="string">"ã©ã¡ã‚‰ã§ã‚‚ãªã„"</span>, 
                              <span class="string">"æ¨å¥¨ã™ã‚‹"</span>, <span class="string">"å¼·ãæ¨å¥¨ã™ã‚‹"</span>),
                           <span class="number">500</span>, replace <span class="operator">=</span> <span class="variable">TRUE</span>,
                           prob <span class="operator">=</span> <span class="function">c</span>(<span class="number">0.05</span>, <span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">0.15</span>))
  )
}

<span class="comment"># å…¨æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
all_survey_data <span class="operator">&lt;-</span> <span class="function">map_dfr</span>(survey_periods, create_survey_data)

<span class="comment"># å› å­ã®é †åºã‚’è¨­å®š</span>
all_survey_data <span class="operator">&lt;-</span> all_survey_data <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    age_group <span class="operator">=</span> <span class="function">fct_relevel</span>(age_group, <span class="string">"20ä»£"</span>, <span class="string">"30ä»£"</span>, <span class="string">"40ä»£"</span>, <span class="string">"50ä»£"</span>, <span class="string">"60ä»£ä»¥ä¸Š"</span>),
    service_satisfaction <span class="operator">=</span> <span class="function">fct_relevel</span>(service_satisfaction, 
                                       <span class="string">"éå¸¸ã«ä¸æº€"</span>, <span class="string">"ä¸æº€"</span>, <span class="string">"æ™®é€š"</span>, <span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>),
    price_satisfaction <span class="operator">=</span> <span class="function">fct_relevel</span>(price_satisfaction,
                                    <span class="string">"é«˜ã™ãã‚‹"</span>, <span class="string">"ã‚„ã‚„é«˜ã„"</span>, <span class="string">"é©æ­£"</span>, <span class="string">"ã‚„ã‚„å®‰ã„"</span>, <span class="string">"å®‰ã„"</span>),
    recommendation <span class="operator">=</span> <span class="function">fct_relevel</span>(recommendation,
                              <span class="string">"å…¨ãæ¨å¥¨ã—ãªã„"</span>, <span class="string">"æ¨å¥¨ã—ãªã„"</span>, <span class="string">"ã©ã¡ã‚‰ã§ã‚‚ãªã„"</span>, 
                              <span class="string">"æ¨å¥¨ã™ã‚‹"</span>, <span class="string">"å¼·ãæ¨å¥¨ã™ã‚‹"</span>)
  )

<span class="comment"># æœŸé–“åˆ¥ãƒ»å¹´ä»£åˆ¥ã®è©³ç´°åˆ†æ</span>
period_age_analysis <span class="operator">&lt;-</span> all_survey_data <span class="operator">%&gt;%</span>
  <span class="function">group_by</span>(period, age_group) <span class="operator">%&gt;%</span>
  <span class="function">nest</span>() <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    analysis <span class="operator">=</span> <span class="function">map</span>(data, ~ {
      <span class="function">list</span>(
        service_pos_rate <span class="operator">=</span> <span class="function">mean</span>(.x$service_satisfaction <span class="operator">%in%</span> <span class="function">c</span>(<span class="string">"æº€è¶³"</span>, <span class="string">"éå¸¸ã«æº€è¶³"</span>)),
        price_acceptable_rate <span class="operator">=</span> <span class="function">mean</span>(.x$price_satisfaction <span class="operator">%in%</span> <span class="function">c</span>(<span class="string">"é©æ­£"</span>, <span class="string">"ã‚„ã‚„å®‰ã„"</span>, <span class="string">"å®‰ã„"</span>)),
        recommendation_rate <span class="operator">=</span> <span class="function">mean</span>(.x$recommendation <span class="operator">%in%</span> <span class="function">c</span>(<span class="string">"æ¨å¥¨ã™ã‚‹"</span>, <span class="string">"å¼·ãæ¨å¥¨ã™ã‚‹"</span>)),
        sample_size <span class="operator">=</span> <span class="function">nrow</span>(.x)
      )
    })
  )

<span class="comment"># åˆ†æçµæœã‚’å±•é–‹</span>
detailed_analysis <span class="operator">&lt;-</span> period_age_analysis <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    service_pos_rate <span class="operator">=</span> <span class="function">map_dbl</span>(analysis, ~ .x$service_pos_rate),
    price_acceptable_rate <span class="operator">=</span> <span class="function">map_dbl</span>(analysis, ~ .x$price_acceptable_rate),
    recommendation_rate <span class="operator">=</span> <span class="function">map_dbl</span>(analysis, ~ .x$recommendation_rate),
    sample_size <span class="operator">=</span> <span class="function">map_dbl</span>(analysis, ~ .x$sample_size)
  ) <span class="operator">%&gt;%</span>
  <span class="function">select</span>(-data, -analysis) <span class="operator">%&gt;%</span>
  <span class="function">arrange</span>(period, age_group)

<span class="function">print</span>(detailed_analysis)

<span class="comment"># ç·åˆæº€è¶³åº¦ã‚¹ã‚³ã‚¢ã®ç®—å‡º</span>
satisfaction_scores <span class="operator">&lt;-</span> all_survey_data <span class="operator">%&gt;%</span>
  <span class="function">group_by</span>(period) <span class="operator">%&gt;%</span>
  <span class="function">nest</span>() <span class="operator">%&gt;%</span>
  <span class="function">mutate</span>(
    overall_score <span class="operator">=</span> <span class="function">map_dbl</span>(data, ~ {
      service_score <span class="operator">&lt;-</span> <span class="function">mean</span>(<span class="function">as.numeric</span>(.x$service_satisfaction))
      price_score <span class="operator">&lt;-</span> <span class="function">mean</span>(<span class="function">as.numeric</span>(.x$price_satisfaction))
      recommendation_score <span class="operator">&lt;-</span> <span class="function">mean</span>(<span class="function">as.numeric</span>(.x$recommendation))
      (service_score <span class="operator">+</span> price_score <span class="operator">+</span> recommendation_score) / <span class="number">3</span>
    })
  ) <span class="operator">%&gt;%</span>
  <span class="function">select</span>(period, overall_score)

<span class="function">print</span>(satisfaction_scores)
</div>
            </div>

            <div class="visualization">
                <div class="viz-title">å››åŠæœŸåˆ¥æº€è¶³åº¦æ¨ç§»</div>
                <svg width="600" height="300" viewBox="0 0 600 300">
                    <!-- Background -->
                    <rect width="600" height="300" fill="#1a1a1a" stroke="#00d4ff" stroke-width="1"/>
                    
                    <!-- Title -->
                    <text x="300" y="25" text-anchor="middle" fill="#00d4ff" font-size="16" font-weight="bold">å››åŠæœŸåˆ¥ç·åˆæº€è¶³åº¦ã‚¹ã‚³ã‚¢</text>
                    
                    <!-- Grid lines -->
                    <line x1="80" y1="50" x2="80" y2="230" stroke="#333" stroke-width="1"/>
                    <line x1="80" y1="230" x2="520" y2="230" stroke="#333" stroke-width="1"/>
                    
                    <!-- Satisfaction score line -->
                    <polyline points="120,180 220,170 320,160 420,150" 
                              fill="none" stroke="#00ff88" stroke-width="3"/>
                    
                    <!-- Data points -->
                    <circle cx="120" cy="180" r="5" fill="#00ff88"/>
                    <circle cx="220" cy="170" r="5" fill="#00ff88"/>
                    <circle cx="320" cy="160" r="5" fill="#00ff88"/>
                    <circle cx="420" cy="150" r="5" fill="#00ff88"/>
                    
                    <!-- Labels -->
                    <text x="120" y="250" text-anchor="middle" fill="#b3b3b3" font-size="12">2023Q1</text>
                    <text x="220" y="250" text-anchor="middle" fill="#b3b3b3" font-size="12">2023Q2</text>
                    <text x="320" y="250" text-anchor="middle" fill="#b3b3b3" font-size="12">2023Q3</text>
                    <text x="420" y="250" text-anchor="middle" fill="#b3b3b3" font-size="12">2023Q4</text>
                    
                    <!-- Y-axis labels -->
                    <text x="70" y="230" text-anchor="end" fill="#b3b3b3" font-size="10">2.0</text>
                    <text x="70" y="190" text-anchor="end" fill="#b3b3b3" font-size="10">2.5</text>
                    <text x="70" y="150" text-anchor="end" fill="#b3b3b3" font-size="10">3.0</text>
                    <text x="70" y="110" text-anchor="end" fill="#b3b3b3" font-size="10">3.5</text>
                    <text x="70" y="70" text-anchor="end" fill="#b3b3b3" font-size="10">4.0</text>
                    
                    <!-- Values -->
                    <text x="120" y="170" text-anchor="middle" fill="#00ff88" font-size="10" font-weight="bold">2.8</text>
                    <text x="220" y="160" text-anchor="middle" fill="#00ff88" font-size="10" font-weight="bold">2.9</text>
                    <text x="320" y="150" text-anchor="middle" fill="#00ff88" font-size="10" font-weight="bold">3.1</text>
                    <text x="420" y="140" text-anchor="middle" fill="#00ff88" font-size="10" font-weight="bold">3.2</text>
                </svg>
            </div>
        </section>

        <div class="key-points">
            <h4>ç¬¬6ç« ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h4>
            <ul>
                <li><strong>forcats</strong>ã§å› å­ãƒ‡ãƒ¼ã‚¿ã®é †åºã¨åˆ†é¡ã‚’è‡ªåœ¨ã«æ“ä½œ</li>
                <li><strong>purrr</strong>ã®é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§åŠ¹ç‡çš„ãªåå¾©å‡¦ç†ã‚’å®Ÿç¾</li>
                <li><strong>mapé–¢æ•°ãƒ•ã‚¡ãƒŸãƒªãƒ¼</strong>ã‚’ä½¿ã£ãŸä¸€æ‹¬ãƒ‡ãƒ¼ã‚¿å‡¦ç†</li>
                <li><strong>ãƒã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</strong>ã®éšå±¤çš„åˆ†ææ‰‹æ³•</li>
                <li><strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</strong>ã§å …ç‰¢ãªãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰</li>
                <li><strong>è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</strong>ã®çµ±åˆåˆ†æã«ã‚ˆã‚‹æ´å¯Ÿç²å¾—</li>
            </ul>
        </div>

        <div class="tip-box">
            <h4>å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4>
            <p>forcatsã¨purrrã®çµ„ã¿åˆã‚ã›ã¯ã€å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿åˆ†æãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§çœŸä¾¡ã‚’ç™ºæ®ã—ã¾ã™ã€‚ç‰¹ã«ã€è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ«å¤‰æ•°ã‚’å«ã‚€èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã‚„ã€æ™‚ç³»åˆ—ã§è“„ç©ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®åˆ†æã«ãŠã„ã¦ã€ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®ç¿’å¾—ã¯ä½œæ¥­åŠ¹ç‡ã‚’åŠ‡çš„ã«å‘ä¸Šã•ã›ã¾ã™ã€‚</p>
        </div>

        <nav class="chapter-nav">
            <a href="chapter5-stringr-text-processing.html" class="nav-button">â† ç¬¬5ç« </a>
            <a href="chapter1-tidyverse-overview.html" class="nav-button">ç¬¬1ç« ã«æˆ»ã‚‹</a>
        </nav>
    </div>
</body>
</html>