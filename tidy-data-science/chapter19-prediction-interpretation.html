<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第19章: 予測と解釈 | Tidyverse完全マスター</title>
    <link rel="canonical" href="https://mechatora.com/tidy-data-science/chapter19-prediction-interpretation.html">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RBPWE348T2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RBPWE348T2');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1184134440246706"
         crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-neon: #00ff88;
            --accent-cyan: #00d4ff;
            --accent-purple: #9d4edd;
            --accent-emerald: #10d9c4;
            --accent-lime: #84cc16;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-neon: #00ff88;
            --shadow-neon: 0 0 20px #00ff8840;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(45deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 20px;
            border: 2px solid var(--border-neon);
            box-shadow: var(--shadow-neon);
        }

        h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, var(--accent-neon), var(--accent-cyan));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* Navigation */
        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .nav-btn {
            padding: 12px 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-neon);
            border-radius: 10px;
            color: var(--accent-neon);
            text-decoration: none;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
            box-shadow: var(--shadow-neon);
        }

        /* Content Sections */
        .section {
            background: var(--bg-secondary);
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 15px;
            border: 1px solid var(--accent-purple);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan));
        }

        h2 {
            color: var(--accent-cyan);
            font-size: 2rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h3 {
            color: var(--accent-emerald);
            font-size: 1.5rem;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: var(--accent-lime);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        /* Code Blocks */
        pre {
            background: var(--bg-primary);
            border: 1px solid var(--accent-neon);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            position: relative;
        }

        pre::before {
            content: '💻 R Code';
            position: absolute;
            top: -12px;
            right: 20px;
            background: var(--bg-secondary);
            color: var(--accent-neon);
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        code {
            color: var(--accent-neon);
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* List Styles */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        /* Special Boxes */
        .tip-box {
            background: linear-gradient(135deg, var(--accent-emerald)20, var(--bg-tertiary));
            border: 1px solid var(--accent-emerald);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .tip-box::before {
            content: '💡 Tip';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-secondary);
            color: var(--accent-emerald);
            padding: 4px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        .warning-box {
            background: linear-gradient(135deg, #ff444420, var(--bg-tertiary));
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .warning-box::before {
            content: '⚠️ 注意';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-secondary);
            color: #ff4444;
            padding: 4px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 200px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🔮 第19章: 予測と解釈</h1>
            <p class="subtitle">実用的な予測とモデル解釈可能性をマスターする</p>
        </header>

        <nav>
            <a href="index.html" class="nav-button">目次へ戻る</a>
            <a href="chapter18-model-evaluation-yardstick.html" class="nav-btn">⬅️ 前の章</a>
            <a href="chapter20-ensemble-learning-enhanced.html" class="nav-btn">➡️ 次の章</a>
        </nav>

        <div class="section">
            <h2>🎯 Chapter 19の学習目標</h2>
            <ul>
                <li><strong>新しいデータでの予測</strong>実行と予測区間の計算</li>
                <li><strong>モデルの解釈可能性</strong>向上手法</li>
                <li><strong>特徴量重要度</strong>の算出と可視化</li>
                <li><strong>SHAP値・LIME</strong>による局所的解釈</li>
                <li><strong>部分依存プロット</strong>による大域的解釈</li>
            </ul>

            <pre>
# 基本セットアップ
library(tidymodels)
library(tidyverse)
library(vip)        # Variable Importance Plots
library(DALEXtra)   # Model Agnostic Explanations
library(DALEX)      # Descriptive mAchine Learning EXplanations

# データとモデルの準備
data("ames", package = "modeldata")
ames_clean <- ames |>
  select(Sale_Price, Lot_Area, Year_Built, 
         Neighborhood, House_Style, Overall_Qual) |>
  mutate(log_price = log10(Sale_Price))

# Train/Test分割
set.seed(123)
ames_split <- initial_split(ames_clean, prop = 0.8)
ames_train <- training(ames_split)
ames_test <- testing(ames_split)
</pre>
        </div>

        <div class="section">
            <h2>🔍 新しいデータでの予測</h2>
            
            <h3>1. 基本的な予測実行</h3>
            <p>訓練済みモデルを使用して新しいデータで予測を行います。</p>

            <pre>
# Random Forest モデルの訓練
rf_recipe <- recipe(log_price ~ ., data = ames_train) |>
  step_rm(Sale_Price) |>
  step_dummy(all_nominal_predictors()) |>
  step_normalize(all_numeric_predictors()) |>
  step_zv(all_predictors())

rf_spec <- rand_forest(
  mtry = 4,
  trees = 500,
  min_n = 5
) |>
  set_engine("ranger", importance = "impurity") |>
  set_mode("regression")

rf_workflow <- workflow() |>
  add_recipe(rf_recipe) |>
  add_model(rf_spec)

# モデル訓練
rf_fit <- rf_workflow |> fit(ames_train)

# テストデータでの予測
test_predictions <- rf_fit |>
  predict(ames_test) |>
  bind_cols(ames_test |> select(log_price, Sale_Price))

test_predictions |>
  head(10)
</pre>

            <h3>2. 予測区間の計算</h3>
            <p>予測の不確実性を量化して区間推定を行います。</p>

            <pre>
# 量分位回帰による予測区間
library(quantreg)

# 分位点予測のためのモデル（複数の分位点）
quantile_spec <- linear_reg() |>
  set_engine("quantreg", tau = 0.1)  # 10%分位点

# 異なる分位点での予測
quantiles <- c(0.1, 0.25, 0.5, 0.75, 0.9)

quantile_predictions <- map_dfr(quantiles, ~ {
  quantile_model <- linear_reg() |>
    set_engine("quantreg", tau = .x) |>
    set_mode("regression")
  
  quantile_wf <- workflow() |>
    add_recipe(rf_recipe) |>
    add_model(quantile_model)
  
  quantile_fit <- quantile_wf |> fit(ames_train)
  
  predict(quantile_fit, ames_test) |>
    mutate(quantile = .x)
}) |>
  bind_cols(ames_test |> select(log_price) |> slice(rep(1:n(), 5)))

# 予測区間の可視化
prediction_intervals <- quantile_predictions |>
  pivot_wider(names_from = quantile, values_from = .pred, names_prefix = "q") |>
  mutate(row_id = row_number())

prediction_intervals |>
  slice_head(n = 50) |>
  ggplot(aes(x = row_id)) +
  geom_ribbon(aes(ymin = q0.1, ymax = q0.9), alpha = 0.3, fill = "lightblue") +
  geom_ribbon(aes(ymin = q0.25, ymax = q0.75), alpha = 0.5, fill = "lightgreen") +
  geom_line(aes(y = q0.5), color = "blue", size = 1) +
  geom_point(aes(y = log_price), color = "red", alpha = 0.7) +
  labs(title = "Prediction Intervals",
       x = "Observation", y = "Log Price",
       subtitle = "Blue ribbon: 80% interval, Green: 50% interval") +
  theme_minimal()
</pre>

            <h3>3. Bootstrap による予測区間</h3>
            <pre>
# Bootstrap による予測区間
library(rsample)

# Bootstrap サンプルでのモデル訓練
bootstrap_models <- bootstraps(ames_train, times = 100) |>
  mutate(
    models = map(splits, ~ {
      boot_data <- analysis(.x)
      rf_workflow |> fit(boot_data)
    })
  )

# 新しいデータ点での予測（例：最初のテストサンプル）
new_observation <- ames_test |> slice(1)

bootstrap_predictions <- bootstrap_models |>
  mutate(
    predictions = map_dbl(models, ~ {
      predict(.x, new_observation)$.pred
    })
  )

# 予測区間の計算
prediction_summary <- bootstrap_predictions |>
  summarise(
    median_pred = median(predictions),
    lower_95 = quantile(predictions, 0.025),
    upper_95 = quantile(predictions, 0.975),
    lower_50 = quantile(predictions, 0.25),
    upper_50 = quantile(predictions, 0.75)
  )

prediction_summary
</pre>
        </div>

        <div class="section">
            <h2>📊 特徴量重要度分析</h2>
            
            <h3>1. モデル固有の重要度</h3>
            <p>Random Forestの内蔵重要度指標を活用します。</p>

            <pre>
# vipパッケージによる重要度可視化
library(vip)

# 基本的な特徴量重要度
importance_plot <- rf_fit |>
  extract_fit_parsnip() |>
  vip(num_features = 15, geom = "col") +
  theme_minimal() +
  labs(title = "Feature Importance (Random Forest)")

importance_plot

# 数値での重要度取得
importance_values <- rf_fit |>
  extract_fit_parsnip() |>
  vi() |>
  arrange(desc(Importance))

importance_values
</pre>

            <h3>2. Permutation Importance</h3>
            <p>モデルに依存しない重要度測定手法です。</p>

            <pre>
# Permutation importanceの計算
library(DALEX)

# DALEX explainerの作成
explainer <- explain(
  model = rf_fit,
  data = ames_train |> select(-log_price, -Sale_Price),
  y = ames_train$log_price,
  label = "Random Forest",
  verbose = FALSE
)

# Permutation importanceの計算
perm_importance <- model_parts(explainer, type = "difference")

# 結果の可視化
plot(perm_importance) + 
  ggtitle("Permutation Feature Importance") +
  theme_minimal()

# 数値結果
perm_importance$result |>
  filter(permutation == 0) |>  # baseline
  arrange(desc(dropout_loss)) |>
  head(10)
</pre>

            <h3>3. SHAP値による重要度</h3>
            <pre>
# SHAP値の計算（サンプルデータで）
library(shapr)

# 少数サンプルでのSHAP値計算
sample_data <- ames_test |> 
  select(-log_price, -Sale_Price) |>
  slice_head(n = 10)

# SHAP値計算の準備
shap_explainer <- explain(
  model = rf_fit,
  data = ames_train |> select(-log_price, -Sale_Price),
  y = ames_train$log_price,
  verbose = FALSE
)

# SHAP値計算
shap_values <- predict_parts(
  shap_explainer, 
  new_observation = sample_data[1, ],
  type = "shap"
)

# SHAP値の可視化
plot(shap_values) + 
  ggtitle("SHAP Values for Single Prediction") +
  theme_minimal()
</pre>
        </div>

        <div class="section">
            <h2>🌍 大域的解釈：部分依存プロット</h2>
            
            <h3>1. 単変数部分依存プロット</h3>
            <p>個々の特徴量がモデル予測に与える平均的な影響を可視化します。</p>

            <pre>
# 部分依存プロットの作成
pdp_year_built <- model_profile(
  explainer,
  variables = "Year_Built",
  N = 100  # サンプル数
)

# 可視化
plot(pdp_year_built) +
  ggtitle("Partial Dependence: Year_Built") +
  theme_minimal()

# 複数変数の部分依存プロット
pdp_multi <- model_profile(
  explainer,
  variables = c("Year_Built", "Lot_Area", "Overall_Qual"),
  N = 50
)

plot(pdp_multi) +
  ggtitle("Partial Dependence: Multiple Variables") +
  theme_minimal()
</pre>

            <h3>2. 2次元部分依存プロット</h3>
            <pre>
# 2変数間の相互作用
pdp_2d <- model_profile(
  explainer,
  variables = c("Year_Built", "Overall_Qual"),
  type = "partial",
  variable_splits = list(
    Year_Built = seq(1900, 2010, by = 20),
    Overall_Qual = 1:10
  )
)

# ヒートマップでの可視化
library(plotly)

# データ整形
pdp_data <- pdp_2d$result |>
  select(`_vname_`, `_x_`, `_yhat_`) |>
  pivot_wider(names_from = `_vname_`, values_from = `_x_`) |>
  filter(!is.na(Year_Built), !is.na(Overall_Qual))

# ヒートマップ作成
ggplot(pdp_data, aes(x = Year_Built, y = Overall_Qual, fill = `_yhat_`)) +
  geom_tile() +
  scale_fill_viridis_c(name = "Predicted\nLog Price") +
  labs(title = "2D Partial Dependence Plot",
       x = "Year Built", y = "Overall Quality") +
  theme_minimal()
</pre>

            <h3>3. 累積局所効果プロット（ALE）</h3>
            <pre>
# ALE plotの作成
ale_plot <- model_profile(
  explainer,
  variables = "Year_Built",
  type = "accumulated"
)

plot(ale_plot) +
  ggtitle("Accumulated Local Effects: Year_Built") +
  theme_minimal()

# 複数変数のALE
ale_multi <- model_profile(
  explainer,
  variables = c("Year_Built", "Lot_Area"),
  type = "accumulated"
)

plot(ale_multi) +
  ggtitle("ALE Plots: Multiple Variables") +
  theme_minimal()
</pre>
        </div>

        <div class="section">
            <h2>🎯 局所的解釈：LIME</h2>
            
            <h3>1. LIME による個別予測の説明</h3>
            <p>Local Interpretable Model-agnostic Explanations による局所的解釈です。</p>

            <pre>
# LIMEによる局所的説明
library(lime)

# LIME explainerの作成
lime_explainer <- lime(
  x = ames_train |> select(-log_price, -Sale_Price),
  model = rf_fit,
  bin_continuous = TRUE,
  n_bins = 4
)

# 個別サンプルの説明
explanation <- explain(
  x = ames_test |> slice(1:3) |> select(-log_price, -Sale_Price),
  explainer = lime_explainer,
  n_features = 10,
  n_permutations = 1000
)

# 結果の可視化
plot_features(explanation) +
  labs(title = "LIME Explanations for Individual Predictions") +
  theme_minimal()

# 説明の詳細
explanation |>
  select(case, feature, feature_weight, feature_desc) |>
  arrange(case, desc(abs(feature_weight)))
</pre>

            <h3>2. テキスト形式での解釈</h3>
            <pre>
# より詳細な LIME 説明
detailed_explanation <- explain(
  x = ames_test |> slice(1) |> select(-log_price, -Sale_Price),
  explainer = lime_explainer,
  n_features = 5,
  feature_select = "highest_weights"
)

# テキスト形式の説明生成
explanation_text <- detailed_explanation |>
  mutate(
    contribution = ifelse(feature_weight > 0, 
                         paste("増加要因:", feature_desc), 
                         paste("減少要因:", feature_desc)),
    impact = paste0("(影響度: ", round(abs(feature_weight), 3), ")")
  ) |>
  select(contribution, impact) |>
  unite("explanation", contribution:impact, sep = " ")

cat("予測値:", round(detailed_explanation$prediction[1], 3), "\n")
cat("実際値:", round(ames_test$log_price[1], 3), "\n\n")
cat("主要な説明要因:\n")
cat(paste(explanation_text$explanation, collapse = "\n"))
</pre>
        </div>

        <div class="section">
            <h2>🔧 解釈可能性のベストプラクティス</h2>
            
            <h3>1. 包括的解釈レポート</h3>
            <pre>
# 包括的解釈関数
comprehensive_interpretation <- function(model, train_data, test_data, target_col) {
  
  # 基本情報
  model_info <- list(
    model_type = class(model)[1],
    n_features = ncol(train_data) - 1,
    n_train = nrow(train_data),
    n_test = nrow(test_data)
  )
  
  # 全体的重要度
  global_importance <- model |>
    extract_fit_parsnip() |>
    vi() |>
    arrange(desc(Importance))
  
  # 予測性能
  predictions <- predict(model, test_data) |>
    bind_cols(test_data |> select(all_of(target_col)))
  
  performance <- predictions |>
    metrics(truth = all_of(target_col), estimate = .pred)
  
  # 特徴量統計
  feature_stats <- train_data |>
    select(-all_of(target_col)) |>
    summarise(across(everything(), list(
      mean = ~ mean(.x, na.rm = TRUE),
      median = ~ median(.x, na.rm = TRUE),
      sd = ~ sd(.x, na.rm = TRUE)
    )))
  
  list(
    model_info = model_info,
    performance = performance,
    importance = global_importance,
    feature_stats = feature_stats,
    predictions = predictions
  )
}

# 実行
interpretation_report <- comprehensive_interpretation(
  rf_fit, 
  ames_train, 
  ames_test, 
  "log_price"
)

# レポート表示
interpretation_report$model_info
interpretation_report$performance
interpretation_report$importance |> head(10)
</pre>

            <h3>2. 対話的解釈ダッシュボード</h3>
            <pre>
# Shiny アプリケーション用のコード例
library(shiny)
library(plotly)

# UI定義（簡略版）
ui <- fluidPage(
  titlePanel("Model Interpretation Dashboard"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("interpretation_type", "解釈手法:",
                  choices = c("Feature Importance", "Partial Dependence", 
                             "SHAP Values", "LIME")),
      selectInput("feature", "特徴量選択:",
                  choices = names(ames_train)),
      numericInput("sample_id", "サンプルID:", value = 1, min = 1, max = 100)
    ),
    
    mainPanel(
      plotlyOutput("interpretation_plot"),
      verbatimTextOutput("interpretation_text")
    )
  )
)

# Server定義（簡略版）
server <- function(input, output, session) {
  
  output$interpretation_plot <- renderPlotly({
    # 選択された解釈手法に応じてプロット生成
    if(input$interpretation_type == "Feature Importance") {
      p <- rf_fit |>
        extract_fit_parsnip() |>
        vip(num_features = 10) +
        theme_minimal()
      ggplotly(p)
    }
    # 他の解釈手法も同様に実装
  })
  
  output$interpretation_text <- renderText({
    paste("選択された解釈手法:", input$interpretation_type)
  })
}

# アプリケーション実行（コメントアウト）
# shinyApp(ui = ui, server = server)
</pre>

            <div class="tip-box">
                <p><strong>解釈可能性のガイドライン：</strong></p>
                <ul>
                    <li><strong>複数手法の組み合わせ</strong>: 大域的・局所的解釈の併用</li>
                    <li><strong>ステークホルダー考慮</strong>: 対象ユーザーに応じた説明</li>
                    <li><strong>継続的検証</strong>: 時間経過による解釈の変化確認</li>
                    <li><strong>バイアス検出</strong>: 不公平な判断基準の特定</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>🎯 まとめと次のステップ</h2>
            
            <h3>Chapter 19で学んだこと</h3>
            <ul>
                <li>新しいデータでの予測実行と予測区間の計算</li>
                <li>特徴量重要度の多角的な分析手法</li>
                <li>部分依存プロットによる大域的解釈</li>
                <li>LIME・SHAPによる局所的解釈</li>
                <li>包括的な解釈レポートの作成</li>
            </ul>

            <h3>実用化のポイント</h3>
            <div class="warning-box">
                <ul>
                    <li><strong>解釈の限界を理解</strong>: 相関と因果の区別</li>
                    <li><strong>計算コストの考慮</strong>: 実時間制約との バランス</li>
                    <li><strong>説明の品質担保</strong>: 解釈結果の妥当性検証</li>
                    <li><strong>継続的監視</strong>: モデルドリフトの検出</li>
                </ul>
            </div>

            <h3>次の章への準備</h3>
            <p>次の第20章では、複数のモデルを組み合わせる<strong>アンサンブル学習</strong>を学習します。stacksパッケージを使用して、予測精度をさらに向上させる手法を習得しましょう。</p>
        </div>

        <nav style="margin-top: 40px;">
            <a href="index.html" class="nav-button">目次へ戻る</a>
            <a href="chapter18-model-evaluation-yardstick.html" class="nav-btn">⬅️ 前の章</a>
            <a href="chapter20-ensemble-learning-enhanced.html" class="nav-btn">➡️ 次の章</a>
        </nav>

        <div class="navigation">
            <a href="chapter23-deep-learning-torch.html" class="nav-button">← 前の章</a>
            <a href="index.html" class="nav-button">目次へ戻る</a>
            <a href="chapter1-tidyverse-overview.html" class="nav-button">次の章 →</a>
        </div>

    <!-- 学習におすすめの書籍 -->
    <section class="book-recommendations" style="margin: 4rem 0; padding: 2rem; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; backdrop-filter: blur(10px);">
        <div class="container">
            <h3 style="color: var(--neon-cyan); font-family: var(--font-tech); font-size: 1.8rem; margin-bottom: 2rem; text-align: center;">
                📚 学習におすすめの書籍
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;">
                
                <!-- Book 1 -->
                <div class="book-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <a href="https://amzn.to/48d9vpc" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
                        <div style="display: flex; flex-direction: column; height: 100%;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--neon-lime); font-size: 1.2rem; margin-bottom: 1rem; font-family: var(--font-tech);">
                                    🔥 RユーザのためのRStudio[実践]入門
                                </h4>
                                <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem;">
                                    tidyverseの基礎から実践まで網羅した日本語決定版。RStudioとtidyverseでデータ分析をマスター。
                                </p>
                            </div>
                            <div style="background: var(--gradient-cyber); color: var(--void-black); padding: 0.8rem 1.5rem; border-radius: 25px; text-align: center; font-weight: 600; font-family: var(--font-tech); margin-top: auto;">
                                Amazonで詳細を見る →
                            </div>
                        </div>
                    </a>
                </div>
                
                <!-- Book 2 -->
                <div class="book-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <a href="https://amzn.to/3IfcanU" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
                        <div style="display: flex; flex-direction: column; height: 100%;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--neon-magenta); font-size: 1.2rem; margin-bottom: 1rem; font-family: var(--font-tech);">
                                    🤖 Rユーザのためのtidymodels[実践]入門
                                </h4>
                                <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem;">
                                    tidymodelsで機械学習を実践するための日本語ガイド。モデル構築から評価まで完全網羅。
                                </p>
                            </div>
                            <div style="background: var(--gradient-plasma); color: white; padding: 0.8rem 1.5rem; border-radius: 25px; text-align: center; font-weight: 600; font-family: var(--font-tech); margin-top: auto;">
                                Amazonで詳細を見る →
                            </div>
                        </div>
                    </a>
                </div>
                
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; font-style: italic;">
                    ※ 当サイトはAmazonアソシエイトプログラムに参加しています
                </p>
            </div>
        </div>
    </section>
    
    <style>
    .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        border-color: var(--neon-cyan);
    }

    .book-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s ease;
    }

    .book-card:hover::before {
        left: 100%;
    }
    </style>

    </div>
</body>
</html>