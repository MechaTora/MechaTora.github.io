<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬18ç« : ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã®æ¥µæ„ - yardstick | Tidyverseå®Œå…¨ãƒã‚¹ã‚¿ãƒ¼</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RBPWE348T2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RBPWE348T2');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1184134440246706"
         crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --accent-neon: #00ff88;
            --accent-cyan: #00d4ff;
            --accent-purple: #9d4edd;
            --accent-emerald: #10d9c4;
            --accent-lime: #84cc16;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-neon: #00ff88;
            --shadow-neon: 0 0 20px #00ff8840;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(45deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 20px;
            border: 2px solid var(--accent-neon);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            animation: scan 3s infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-neon);
            margin-bottom: 10px;
            text-shadow: 0 0 20px var(--accent-neon);
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.4rem;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .chapter-meta {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            position: relative;
            z-index: 1;
        }

        .chapter-description {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Navigation Widget */
        .chapter-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3px;
            margin: 30px 0;
            padding: 6px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--accent-neon);
            width: fit-content;
            max-width: 90vw;
            margin-left: auto;
            margin-right: auto;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 1px 5px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 2px;
            border: 1px solid var(--accent-cyan);
            transition: all 0.3s ease;
            font-size: 0.65rem;
            white-space: nowrap;
        }

        .nav-button:hover {
            background: var(--accent-cyan);
            color: var(--bg-primary);
            box-shadow: 0 0 6px var(--accent-cyan);
        }

        .nav-button.current {
            background: var(--accent-neon);
            color: var(--bg-primary);
            box-shadow: 0 0 6px var(--accent-neon);
        }

        /* Content Sections */
        .section {
            background: rgba(255, 255, 255, 0.02);
            margin: 30px 0;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.15);
            position: relative;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-neon), var(--accent-cyan), var(--accent-purple));
            border-radius: 15px 15px 0 0;
        }

        h2 {
            color: var(--accent-neon);
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--accent-neon);
        }

        h3 {
            color: var(--accent-cyan);
            font-size: 1.5rem;
            margin: 25px 0 15px 0;
            text-shadow: 0 0 8px var(--accent-cyan);
        }

        h4 {
            color: var(--accent-purple);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        /* Code Blocks */
        .code-block {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--accent-neon);
            border-radius: 15px;
            overflow: hidden;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.1);
        }

        .code-header {
            background: rgba(0, 255, 136, 0.1);
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--accent-neon);
        }

        .code-dots {
            display: flex;
            gap: 0.3rem;
        }

        .code-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-neon);
            opacity: 0.6;
        }

        .code-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-cyan);
            font-weight: 500;
        }

        .code-content {
            padding: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            overflow-x: auto;
            background: #0d1117;
        }

        .code-line {
            display: block;
            margin-bottom: 0.3rem;
        }

        /* Syntax highlighting */
        .code-comment { color: #8b949e; }
        .code-keyword { color: #ff7b72; }
        .code-string { color: #a5d6ff; }
        .code-function { color: #d2a8ff; }
        .code-variable { color: #ffa657; }
        .code-regex { color: #39ff14; font-weight: bold; }
        .code-pattern { color: #ffff00; background: rgba(255, 255, 0, 0.1); padding: 0.1rem 0.3rem; border-radius: 3px; }

        pre {
            background: var(--bg-primary);
            border: 1px solid var(--accent-neon);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            position: relative;
        }

        pre::before {
            content: 'ğŸ’» R Code';
            position: absolute;
            top: -12px;
            right: 20px;
            background: var(--bg-secondary);
            color: var(--accent-neon);
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        code {
            color: var(--accent-neon);
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* List Styles */
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin-bottom: 8px;
        }

        /* Special Boxes */
        .tip-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), var(--bg-tertiary));
            border: 1px solid var(--accent-neon);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .tip-box::before {
            content: 'ğŸ’¡ Tip';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-secondary);
            color: var(--accent-neon);
            padding: 4px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        .warning-box {
            background: linear-gradient(135deg, #ff444420, var(--bg-tertiary));
            border: 1px solid #ff4444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .warning-box::before {
            content: 'âš ï¸ æ³¨æ„';
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-secondary);
            color: #ff4444;
            padding: 4px 12px;
            border-radius: 5px;
            font-weight: bold;
        }

        /* Function Grid */
        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .function-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-cyan);
            border-radius: 15px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .function-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-neon) 0%, var(--accent-cyan) 50%, var(--accent-purple) 100%);
            opacity: 0.1;
            transition: all 0.5s ease;
            z-index: -1;
        }

        .function-card:hover::before {
            left: 0;
        }

        .function-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        .function-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-neon);
            margin-bottom: 1rem;
        }

        .function-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .function-syntax {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-cyan);
            background: rgba(0, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent-cyan);
        }

        /* Evaluation Workflow */
        .evaluation-workflow {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--accent-purple);
        }

        .workflow-title {
            color: var(--accent-purple);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .workflow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .workflow-step {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--accent-neon);
            text-align: center;
            transition: all 0.3s ease;
        }

        .workflow-step:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
        }

        .step-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .chapter-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 200px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã®æ¥µæ„ - yardstick</h1>
            <div class="subtitle">ç¬¬18ç« : åŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«æ€§èƒ½è©•ä¾¡ã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹</div>
            <div class="chapter-meta">
                <span>ğŸ” Comprehensive Evaluation</span>
                <span>ğŸ“Š Metrics & Visualization</span>
                <span>ğŸ¯ ROC/PR Curves</span>
            </div>
            <p class="chapter-description">
                yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ãƒ¢ãƒ‡ãƒ«æ€§èƒ½ã‚’å¤šè§’çš„ã«è©•ä¾¡ã€‚å›å¸°ãƒ»åˆ†é¡å•é¡Œã®ä¸»è¦æŒ‡æ¨™ã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªãƒƒã‚¯ã¾ã§ã€å®Ÿç”¨çš„ãªè©•ä¾¡æ‰‹æ³•ã‚’å®Œå…¨ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ã€‚
            </p>
        </header>

        <!-- Navigation Widget -->
        <nav class="chapter-nav">
            <a href="chapter10-advanced-dplyr.html" class="nav-button">Ch10: dplyrå¿œç”¨</a>
            <a href="chapter11-machine-learning.html" class="nav-button">Ch11: æ©Ÿæ¢°å­¦ç¿’</a>
            <a href="chapter12-model-evaluation.html" class="nav-button">Ch12: ãƒ¢ãƒ‡ãƒ«è©•ä¾¡</a>
            <a href="chapter13-advanced-ggplot2.html" class="nav-button">Ch13: ggplot2å¿œç”¨</a>
            <a href="chapter14-interactive-visualization.html" class="nav-button">Ch14: å¯¾è©±çš„å¯è¦–åŒ–</a>
            <a href="chapter15-big-data.html" class="nav-button">Ch15: ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿</a>
            <a href="chapter16-resampling-rsample.html" class="nav-button">Ch16: ãƒªã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</a>
            <a href="chapter17-hyperparameter-tuning.html" class="nav-button">Ch17: ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</a>
            <a href="chapter18-model-evaluation-yardstick.html" class="nav-button current">Ch18: ãƒ¢ãƒ‡ãƒ«è©•ä¾¡</a>
            <a href="chapter19-prediction-interpretation.html" class="nav-button">Ch19: äºˆæ¸¬è§£é‡ˆ</a>
            <a href="chapter20-best-practices.html" class="nav-button">Ch20: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</a>
        </nav>

        <div class="section">
            <h2>ğŸ¯ Chapter 18ã®å­¦ç¿’ç›®æ¨™</h2>
            <p>
                æœ¬ç« ã§ã¯ã€yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸåŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡æ‰‹æ³•ã‚’å­¦ç¿’ã—ã€å®Ÿç”¨çš„ãªè©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
            </p>

            <div class="evaluation-workflow">
                <div class="workflow-title">ğŸ”„ ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</div>
                <div class="workflow-steps">
                    <div class="workflow-step">
                        <div class="step-number">1ï¸âƒ£</div>
                        <div>ãƒ‡ãƒ¼ã‚¿æº–å‚™</div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">2ï¸âƒ£</div>
                        <div>åŸºæœ¬æŒ‡æ¨™è¨ˆç®—</div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">3ï¸âƒ£</div>
                        <div>æ··åŒè¡Œåˆ—ä½œæˆ</div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">4ï¸âƒ£</div>
                        <div>ROC/PRæ›²ç·š</div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">5ï¸âƒ£</div>
                        <div>é–¾å€¤æœ€é©åŒ–</div>
                    </div>
                    <div class="workflow-step">
                        <div class="step-number">6ï¸âƒ£</div>
                        <div>ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ</div>
                    </div>
                </div>
            </div>

            <ul>
                <li><strong>yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</strong>ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡</li>
                <li><strong>å›å¸°å•é¡Œ</strong>ã®è©•ä¾¡æŒ‡æ¨™ï¼ˆRMSEã€MAEã€RÂ²ï¼‰ã®ç†è§£ã¨å®Ÿè£…</li>
                <li><strong>åˆ†é¡å•é¡Œ</strong>ã®è©•ä¾¡æŒ‡æ¨™ï¼ˆAccuracyã€Precisionã€Recallã€F1ã€AUCï¼‰</li>
                <li><strong>å¤šã‚¯ãƒ©ã‚¹åˆ†é¡</strong>ã®ç‰¹æ®Šãªè©•ä¾¡æ‰‹æ³•</li>
                <li><strong>ROCæ›²ç·šãƒ»PRæ›²ç·š</strong>ã®ä½œæˆã¨è§£é‡ˆ</li>
                <li><strong>ã‚«ã‚¹ã‚¿ãƒ è©•ä¾¡æŒ‡æ¨™</strong>ã®ä½œæˆ</li>
            </ul>
        </div>

        <!-- KEY FUNCTIONS -->
        <div class="section">
            <h2>âš™ï¸ ä¸»è¦ãªè©•ä¾¡é–¢æ•°</h2>
            <p>
                yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸»è¦é–¢æ•°ã‚’ç†è§£ã—ã€åŠ¹æœçš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†ã€‚
            </p>
            
            <div class="function-grid">
                <div class="function-card">
                    <div class="function-title">metrics()</div>
                    <div class="function-description">
                        ãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬çš„ãªè©•ä¾¡æŒ‡æ¨™ã‚’ä¸€æ‹¬è¨ˆç®—ã€‚å›å¸°ã€åˆ†é¡å•é¡Œã§é©åˆ‡ãªæŒ‡æ¨™ã‚’è‡ªå‹•é¸æŠã€‚
                    </div>
                    <div class="function-syntax">metrics(truth, estimate, ...)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">conf_mat()</div>
                    <div class="function-description">
                        æ··åŒè¡Œåˆ—ï¼ˆConfusion Matrixï¼‰ã‚’ä½œæˆã€‚åˆ†é¡ãƒ¢ãƒ‡ãƒ«ã®è©³ç´°ãªæ€§èƒ½åˆ†æã®åŸºç¤ã€‚
                    </div>
                    <div class="function-syntax">conf_mat(truth, estimate)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">roc_curve()</div>
                    <div class="function-description">
                        ROCæ›²ç·šã‚’ä½œæˆã—ã€ãƒ¢ãƒ‡ãƒ«ã®åˆ¤åˆ¥èƒ½åŠ›ã‚’è©•ä¾¡ã€‚äºŒå€¤åˆ†é¡ã®æ¨™æº–çš„ãªè©•ä¾¡æ‰‹æ³•ã€‚
                    </div>
                    <div class="function-syntax">roc_curve(truth, prob_col)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">pr_curve()</div>
                    <div class="function-description">
                        Precision-Recallæ›²ç·šã‚’ä½œæˆã€‚ä¸å‡è¡¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ç‰¹ã«æœ‰ç”¨ãªè©•ä¾¡æŒ‡æ¨™ã€‚
                    </div>
                    <div class="function-syntax">pr_curve(truth, prob_col)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">metric_set()</div>
                    <div class="function-description">
                        ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚»ãƒƒãƒˆã‚’ä½œæˆã€‚ç‰¹å®šã®ç”¨é€”ã«åˆã‚ã›ãŸè©•ä¾¡æŒ‡æ¨™ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã€‚
                    </div>
                    <div class="function-syntax">metric_set(rmse, mae, rsq)</div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">autoplot()</div>
                    <div class="function-description">
                        è©•ä¾¡çµæœã®è‡ªå‹•å¯è¦–åŒ–ã€‚æ··åŒè¡Œåˆ—ã€ROCæ›²ç·šãªã©ã‚’ç°¡å˜ã«ã‚°ãƒ©ãƒ•åŒ–ã€‚
                    </div>
                    <div class="function-syntax">autoplot(conf_matrix)</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ” yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯</h2>
            <p>yardstickã¯ã€æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½è©•ä¾¡ã®ãŸã‚ã®çµ±ä¸€ã•ã‚ŒãŸAPIã‚’æä¾›ã™ã‚‹Tidymodelsã®ä¸­æ ¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚</p>

            <h3>ä¸»ãªæ©Ÿèƒ½</h3>
            <ul>
                <li>è±Šå¯Œãª<strong>è©•ä¾¡æŒ‡æ¨™</strong>ã®æä¾›</li>
                <li><strong>åˆ†é¡ãƒ»å›å¸°</strong>ä¸¡å¯¾å¿œ</li>
                <li><strong>å¤šã‚¯ãƒ©ã‚¹ãƒ»äºŒå€¤åˆ†é¡</strong>ã®è‡ªå‹•å¯¾å¿œ</li>
                <li><strong>å¯è¦–åŒ–</strong>ã¨ã®ç·Šå¯†ãªé€£æº</li>
                <li><strong>ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™</strong>ã®ä½œæˆæ”¯æ´</li>
            </ul>

            <pre>
# åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
library(tidymodels)
library(tidyverse)
library(yardstick)

# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
data("ames", package = "modeldata")
data("two_class_dat", package = "modeldata")
data("hpc_data", package = "modeldata")

# å›å¸°ç”¨ãƒ‡ãƒ¼ã‚¿
ames_sample <- ames |> 
  select(Sale_Price, Lot_Area, Year_Built, Overall_Qual) |>
  mutate(log_price = log10(Sale_Price)) |>
  slice_sample(n = 1000)

# äºˆæ¸¬çµæœã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
set.seed(123)
ames_predictions <- ames_sample |>
  mutate(
    .pred = log_price + rnorm(n(), 0, 0.1),
    residuals = log_price - .pred
  )

# åˆ†é¡ç”¨ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
classification_sample <- two_class_dat |>
  rename(truth = Class, estimate = predicted) |>
  mutate(
    .pred_Class1 = 1 - .pred_Class2,
    .pred_Class2 = .pred_Class2
  )
</pre>
        </div>

        <div class="section">
            <h2>ğŸ“ˆ å›å¸°å•é¡Œã®è©•ä¾¡æŒ‡æ¨™</h2>
            
            <h3>1. åŸºæœ¬çš„ãªè©•ä¾¡æŒ‡æ¨™</h3>
            <p>å›å¸°å•é¡Œã«ãŠã‘ã‚‹ä»£è¡¨çš„ãªè©•ä¾¡æŒ‡æ¨™ã‚’ç†è§£ã—ã¾ã™ã€‚</p>

            <pre>
# ä¸»è¦ãªå›å¸°æŒ‡æ¨™ã®è¨ˆç®—
regression_metrics <- ames_predictions |>
  metrics(truth = log_price, estimate = .pred)

regression_metrics

# å€‹åˆ¥æŒ‡æ¨™ã®è¨ˆç®—
rmse_value <- ames_predictions |> rmse(truth = log_price, estimate = .pred)
mae_value <- ames_predictions |> mae(truth = log_price, estimate = .pred)
rsq_value <- ames_predictions |> rsq(truth = log_price, estimate = .pred)
mape_value <- ames_predictions |> mape(truth = log_price, estimate = .pred)

# çµæœã®ã¾ã¨ã‚
tibble(
  Metric = c("RMSE", "MAE", "RÂ²", "MAPE"),
  Value = c(rmse_value$.estimate, mae_value$.estimate, 
            rsq_value$.estimate, mape_value$.estimate)
)
</pre>

            <h3>2. ã‚«ã‚¹ã‚¿ãƒ è©•ä¾¡æŒ‡æ¨™ã‚»ãƒƒãƒˆ</h3>
            <p>ç‰¹å®šã®ç”¨é€”ã«å¿œã˜ãŸè©•ä¾¡æŒ‡æ¨™ã‚»ãƒƒãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚</p>

            <pre>
# ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™ã‚»ãƒƒãƒˆã®ä½œæˆ
custom_regression_metrics <- metric_set(
  rmse, mae, rsq, mape, 
  ccc,  # ä¸€è‡´ç›¸é–¢ä¿‚æ•°
  rpiq, # å››åˆ†ä½ç¯„å›²ã«å¯¾ã™ã‚‹äºˆæ¸¬æ€§èƒ½æ¯”
  huber_loss  # Huberæå¤±
)

# ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™ã§ã®è©•ä¾¡
custom_results <- ames_predictions |>
  custom_regression_metrics(truth = log_price, estimate = .pred)

custom_results
</pre>

            <h3>3. ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥è©•ä¾¡</h3>
            <pre>
# å»ºç¯‰å¹´ä»£åˆ¥ã®è©•ä¾¡
ames_grouped <- ames_predictions |>
  mutate(
    era = case_when(
      Year_Built < 1950 ~ "Pre-1950",
      Year_Built < 1980 ~ "1950-1979",
      Year_Built < 2000 ~ "1980-1999",
      TRUE ~ "2000+"
    )
  )

# ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥è©•ä¾¡
grouped_metrics <- ames_grouped |>
  group_by(era) |>
  metrics(truth = log_price, estimate = .pred) |>
  ungroup()

# å¯è¦–åŒ–
grouped_metrics |>
  filter(.metric == "rmse") |>
  ggplot(aes(x = era, y = .estimate)) +
  geom_col(fill = "lightblue") +
  geom_text(aes(label = round(.estimate, 3)), vjust = -0.3) +
  labs(title = "RMSE by Construction Era",
       x = "Era", y = "RMSE") +
  theme_minimal()
</pre>

            <h3>4. æ®‹å·®åˆ†æ</h3>
            <pre>
# æ®‹å·®ã®è©³ç´°åˆ†æ
residual_analysis <- ames_predictions |>
  mutate(
    abs_residuals = abs(residuals),
    squared_residuals = residuals^2,
    standardized_residuals = residuals / sd(residuals)
  )

# æ®‹å·®ãƒ—ãƒ­ãƒƒãƒˆ
p1 <- residual_analysis |>
  ggplot(aes(x = .pred, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  geom_smooth(se = FALSE) +
  labs(title = "Residuals vs Fitted", x = "Fitted", y = "Residuals")

p2 <- residual_analysis |>
  ggplot(aes(sample = standardized_residuals)) +
  stat_qq() + stat_qq_line() +
  labs(title = "Q-Q Plot of Standardized Residuals")

library(patchwork)
p1 + p2
</pre>
        </div>

        <div class="section">
            <h2>ğŸ¯ äºŒå€¤åˆ†é¡å•é¡Œã®è©•ä¾¡</h2>
            
            <h3>1. åŸºæœ¬çš„ãªåˆ†é¡æŒ‡æ¨™</h3>
            <p>äºŒå€¤åˆ†é¡ã«ãŠã‘ã‚‹ä¸»è¦ãªè©•ä¾¡æŒ‡æ¨™ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>

            <pre>
# åŸºæœ¬çš„ãªåˆ†é¡æŒ‡æ¨™
binary_metrics <- classification_sample |>
  metrics(truth = truth, estimate = estimate, .pred_Class1)

binary_metrics

# æ··åŒè¡Œåˆ—ï¼ˆConfusion Matrixï¼‰
conf_matrix <- classification_sample |>
  conf_mat(truth = truth, estimate = estimate)

conf_matrix

# æ··åŒè¡Œåˆ—ã®å¯è¦–åŒ–
autoplot(conf_matrix, type = "heatmap") +
  scale_fill_gradient(low = "white", high = "lightblue") +
  theme_minimal()
</pre>

            <h3>2. ç²¾åº¦ãƒ»å†ç¾ç‡ãƒ»F1ã‚¹ã‚³ã‚¢</h3>
            <pre>
# è©³ç´°ãªåˆ†é¡æŒ‡æ¨™
detailed_metrics <- classification_sample |>
  summarise(
    accuracy = accuracy_vec(truth, estimate),
    precision = precision_vec(truth, estimate),
    recall = recall_vec(truth, estimate),
    f1_score = f_meas_vec(truth, estimate),
    specificity = specificity_vec(truth, estimate),
    sensitivity = sensitivity_vec(truth, estimate)
  )

detailed_metrics

# æŒ‡æ¨™ã®è§£é‡ˆ
interpretation <- tribble(
  ~Metric, ~Formula, ~Interpretation,
  "Accuracy", "(TP + TN) / (TP + TN + FP + FN)", "å…¨ä½“çš„ãªæ­£è§£ç‡",
  "Precision", "TP / (TP + FP)", "é™½æ€§äºˆæ¸¬ã®æ­£ç¢ºã•",
  "Recall (Sensitivity)", "TP / (TP + FN)", "å®Ÿéš›ã®é™½æ€§ã®æ¤œå‡ºç‡",
  "Specificity", "TN / (TN + FP)", "å®Ÿéš›ã®é™°æ€§ã®æ¤œå‡ºç‡",
  "F1 Score", "2 * (Precision * Recall) / (Precision + Recall)", "ç²¾åº¦ã¨å†ç¾ç‡ã®èª¿å’Œå¹³å‡"
)

interpretation
</pre>

            <h3>3. ROCæ›²ç·šã¨AUC</h3>
            <pre>
# ROCæ›²ç·šã®ä½œæˆ
roc_curve_data <- classification_sample |>
  roc_curve(truth = truth, .pred_Class1)

# ROCæ›²ç·šã®å¯è¦–åŒ–
roc_plot <- roc_curve_data |>
  ggplot(aes(x = 1 - specificity, y = sensitivity)) +
  geom_line(size = 1.2, color = "blue") +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "red") +
  coord_equal() +
  labs(title = "ROC Curve",
       x = "False Positive Rate (1 - Specificity)",
       y = "True Positive Rate (Sensitivity)") +
  theme_minimal()

roc_plot

# AUCå€¤ã®è¨ˆç®—
auc_value <- classification_sample |>
  roc_auc(truth = truth, .pred_Class1)

auc_value
</pre>

            <h3>4. PRæ›²ç·šï¼ˆPrecision-Recallæ›²ç·šï¼‰</h3>
            <pre>
# PRæ›²ç·šã®ä½œæˆ
pr_curve_data <- classification_sample |>
  pr_curve(truth = truth, .pred_Class1)

# PRæ›²ç·šã®å¯è¦–åŒ–
pr_plot <- pr_curve_data |>
  ggplot(aes(x = recall, y = precision)) +
  geom_line(size = 1.2, color = "green") +
  labs(title = "Precision-Recall Curve",
       x = "Recall", y = "Precision") +
  theme_minimal()

pr_plot

# PR-AUCå€¤ã®è¨ˆç®—
pr_auc_value <- classification_sample |>
  pr_auc(truth = truth, .pred_Class1)

pr_auc_value

# ROCã¨PRã®æ¯”è¼ƒ
library(patchwork)
(roc_plot + labs(subtitle = paste("AUC =", round(auc_value$.estimate, 3)))) +
(pr_plot + labs(subtitle = paste("PR-AUC =", round(pr_auc_value$.estimate, 3))))
</pre>

            <div class="tip-box">
                <p><strong>ROC vs PRæ›²ç·šã®ä½¿ã„åˆ†ã‘ï¼š</strong></p>
                <ul>
                    <li><strong>ROCæ›²ç·š</strong>: ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«é©ã—ã¦ã„ã‚‹</li>
                    <li><strong>PRæ›²ç·š</strong>: ä¸å‡è¡¡ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆé™½æ€§ã‚µãƒ³ãƒ—ãƒ«ãŒå°‘ãªã„ï¼‰ã«é©ã—ã¦ã„ã‚‹</li>
                    <li>ä¸¡æ–¹ã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½ã‚’å¤šè§’çš„ã«è©•ä¾¡å¯èƒ½</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¨ å¤šã‚¯ãƒ©ã‚¹åˆ†é¡ã®è©•ä¾¡</h2>
            
            <h3>1. å¤šã‚¯ãƒ©ã‚¹åˆ†é¡æŒ‡æ¨™</h3>
            <p>3ã¤ä»¥ä¸Šã®ã‚¯ãƒ©ã‚¹ãŒã‚ã‚‹åˆ†é¡å•é¡Œã®è©•ä¾¡æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã™ã€‚</p>

            <pre>
# å¤šã‚¯ãƒ©ã‚¹åˆ†é¡ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
multiclass_sample <- hpc_data |>
  select(obs, pred, VF:L) |>
  slice_sample(n = 500)

# åŸºæœ¬çš„ãªå¤šã‚¯ãƒ©ã‚¹æŒ‡æ¨™
multiclass_metrics <- multiclass_sample |>
  metrics(truth = obs, estimate = pred, VF:L)

multiclass_metrics

# ã‚¯ãƒ©ã‚¹åˆ¥è©³ç´°è©•ä¾¡
class_metrics <- multiclass_sample |>
  summarise(
    accuracy = accuracy_vec(obs, pred),
    kappa = kap_vec(obs, pred),
    mcc = mcc_vec(obs, pred)  # Matthews correlation coefficient
  )

class_metrics
</pre>

            <h3>2. ãƒã‚¯ãƒ­ãƒ»ãƒã‚¤ã‚¯ãƒ­å¹³å‡</h3>
            <pre>
# ãƒã‚¯ãƒ­å¹³å‡ã¨ãƒã‚¤ã‚¯ãƒ­å¹³å‡ã®è¨ˆç®—
macro_micro_comparison <- tribble(
  ~averaging, ~precision, ~recall, ~f1,
  "macro", 
  precision_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "macro"),
  recall_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "macro"),
  f_meas_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "macro"),
  "micro",
  precision_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "micro"),
  recall_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "micro"),
  f_meas_vec(multiclass_sample$obs, multiclass_sample$pred, estimator = "micro")
)

macro_micro_comparison
</pre>

            <h3>3. ã‚¯ãƒ©ã‚¹åˆ¥è©³ç´°åˆ†æ</h3>
            <pre>
# ã‚¯ãƒ©ã‚¹åˆ¥ã®æ··åŒè¡Œåˆ—
multiclass_conf <- multiclass_sample |>
  conf_mat(truth = obs, estimate = pred)

multiclass_conf

# æ··åŒè¡Œåˆ—ã®å¯è¦–åŒ–
autoplot(multiclass_conf, type = "heatmap") +
  scale_fill_gradient(low = "white", high = "darkblue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# ã‚¯ãƒ©ã‚¹åˆ¥ã®ç²¾åº¦ãƒ»å†ç¾ç‡
class_by_class_metrics <- multiclass_sample |>
  group_by(obs) |>
  summarise(
    count = n(),
    correct = sum(obs == pred),
    accuracy = correct / count
  ) |>
  arrange(desc(accuracy))

class_by_class_metrics
</pre>
        </div>

        <div class="section">
            <h2>ğŸ“Š é–¾å€¤ã®æœ€é©åŒ–</h2>
            
            <h3>1. æœ€é©é–¾å€¤ã®æ¢ç´¢</h3>
            <p>åˆ†é¡å•é¡Œã«ãŠã„ã¦ã€äºˆæ¸¬ç¢ºç‡ã‚’äºŒå€¤ã«å¤‰æ›ã™ã‚‹æœ€é©ãªé–¾å€¤ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚</p>

            <pre>
# ç•°ãªã‚‹é–¾å€¤ã§ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—
threshold_analysis <- tibble(
  threshold = seq(0.1, 0.9, by = 0.05)
) |>
  mutate(
    metrics = map(threshold, ~ {
      classification_sample |>
        mutate(
          pred_class = if_else(.pred_Class1 >= .x, "Class1", "Class2"),
          pred_class = factor(pred_class, levels = levels(truth))
        ) |>
        summarise(
          accuracy = accuracy_vec(truth, pred_class),
          precision = precision_vec(truth, pred_class),
          recall = recall_vec(truth, pred_class),
          f1 = f_meas_vec(truth, pred_class)
        )
    })
  ) |>
  unnest(metrics)

# æœ€é©é–¾å€¤ã®å¯è¦–åŒ–
threshold_plot <- threshold_analysis |>
  pivot_longer(accuracy:f1, names_to = "metric", values_to = "value") |>
  ggplot(aes(x = threshold, y = value, color = metric)) +
  geom_line(size = 1) +
  geom_point() +
  labs(title = "Metrics vs Threshold",
       x = "Threshold", y = "Metric Value",
       color = "Metric") +
  theme_minimal()

threshold_plot

# æœ€é©é–¾å€¤ã®ç‰¹å®š
optimal_thresholds <- threshold_analysis |>
  summarise(
    best_accuracy = threshold[which.max(accuracy)],
    best_f1 = threshold[which.max(f1)],
    best_precision = threshold[which.max(precision)],
    best_recall = threshold[which.max(recall)]
  )

optimal_thresholds
</pre>

            <h3>2. Youden's Jçµ±è¨ˆé‡</h3>
            <pre>
# Youden's Jçµ±è¨ˆé‡ã«ã‚ˆã‚‹æœ€é©é–¾å€¤
# J = Sensitivity + Specificity - 1
youden_analysis <- tibble(
  threshold = seq(0.01, 0.99, by = 0.01)
) |>
  mutate(
    j_stat = map_dbl(threshold, ~ {
      pred_class <- if_else(classification_sample$.pred_Class1 >= .x, 
                           "Class1", "Class2")
      pred_class <- factor(pred_class, levels = levels(classification_sample$truth))
      
      sens <- sensitivity_vec(classification_sample$truth, pred_class)
      spec <- specificity_vec(classification_sample$truth, pred_class)
      
      sens + spec - 1
    })
  )

# æœ€é©é–¾å€¤ã®ç‰¹å®š
optimal_youden <- youden_analysis |>
  slice_max(j_stat, n = 1)

# Youdençµ±è¨ˆé‡ã®å¯è¦–åŒ–
youden_plot <- youden_analysis |>
  ggplot(aes(x = threshold, y = j_stat)) +
  geom_line(size = 1, color = "blue") +
  geom_vline(xintercept = optimal_youden$threshold, 
             color = "red", linetype = "dashed") +
  geom_text(x = optimal_youden$threshold + 0.1, 
            y = optimal_youden$j_stat, 
            label = paste("Optimal =", round(optimal_youden$threshold, 3))) +
  labs(title = "Youden's J Statistic vs Threshold",
       x = "Threshold", y = "J Statistic") +
  theme_minimal()

youden_plot
</pre>
        </div>

        <div class="section">
            <h2>ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ è©•ä¾¡æŒ‡æ¨™ã®ä½œæˆ</h2>
            
            <h3>1. åŸºæœ¬çš„ãªã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™</h3>
            <p>ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã«å¿œã˜ãŸç‹¬è‡ªã®è©•ä¾¡æŒ‡æ¨™ã‚’ä½œæˆã§ãã¾ã™ã€‚</p>

            <pre>
# ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™ã®ä¾‹ï¼šåŠ é‡ç²¾åº¦
weighted_accuracy <- function(data, truth, estimate, class_weights = NULL, ...) {
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é‡ã¿ï¼ˆå…¨ã¦1ï¼‰
  if (is.null(class_weights)) {
    class_weights <- rep(1, length(levels(data[[truth]])))
    names(class_weights) <- levels(data[[truth]])
  }
  
  # æ··åŒè¡Œåˆ—ã®ä½œæˆ
  cm <- table(data[[truth]], data[[estimate]])
  
  # å„ã‚¯ãƒ©ã‚¹ã®æ­£è§£æ•°ã«é‡ã¿ã‚’é©ç”¨
  weighted_correct <- sum(diag(cm) * class_weights[rownames(cm)])
  total_weighted <- sum(cm * outer(class_weights[rownames(cm)], 
                                  class_weights[colnames(cm)]))
  
  # çµæœã‚’è¿”ã™
  tibble(
    .metric = "weighted_accuracy",
    .estimator = "multiclass",
    .estimate = weighted_correct / sum(cm)
  )
}

# ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™ã®ä½¿ç”¨ä¾‹
custom_weights <- c("Class1" = 2, "Class2" = 1)  # Class1ã‚’é‡è¦–

weighted_result <- weighted_accuracy(
  classification_sample, 
  "truth", 
  "estimate", 
  class_weights = custom_weights
)

weighted_result
</pre>

            <h3>2. ãƒ“ã‚¸ãƒã‚¹æŒ‡æ¨™ã®å®Ÿè£…</h3>
            <pre>
# ã‚³ã‚¹ãƒˆè€ƒæ…®è©•ä¾¡æŒ‡æ¨™
cost_sensitive_metric <- function(data, truth, estimate, 
                                 fn_cost = 1, fp_cost = 1, ...) {
  cm <- conf_mat_vec(data[[truth]], data[[estimate]])
  
  # æ··åŒè¡Œåˆ—ã‹ã‚‰å„è¦ç´ ã‚’æŠ½å‡º
  tp <- cm[1, 1]  # True Positive
  tn <- cm[2, 2]  # True Negative  
  fp <- cm[2, 1]  # False Positive
  fn <- cm[1, 2]  # False Negative
  
  # ç·ã‚³ã‚¹ãƒˆã®è¨ˆç®—
  total_cost <- fn * fn_cost + fp * fp_cost
  total_cases <- sum(cm)
  
  # ã‚³ã‚¹ãƒˆ per case
  cost_per_case <- total_cost / total_cases
  
  tibble(
    .metric = "cost_per_case",
    .estimator = "binary",
    .estimate = cost_per_case
  )
}

# ä½¿ç”¨ä¾‹ï¼šå½é™°æ€§ã®ã‚³ã‚¹ãƒˆãŒå½é™½æ€§ã®5å€ã®å ´åˆ
cost_result <- cost_sensitive_metric(
  classification_sample,
  "truth",
  "estimate", 
  fn_cost = 5,
  fp_cost = 1
)

cost_result
</pre>
        </div>

        <div class="section">
            <h2>ğŸ“‹ åŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ</h2>
            
            <h3>1. è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</h3>
            <pre>
# åŒ…æ‹¬çš„è©•ä¾¡é–¢æ•°
comprehensive_evaluation <- function(data, truth_col, pred_col, pred_prob_col) {
  
  # åŸºæœ¬çµ±è¨ˆ
  basic_stats <- data |>
    summarise(
      n_samples = n(),
      n_classes = n_distinct(!!sym(truth_col)),
      class_balance = list(table(!!sym(truth_col)))
    )
  
  # åŸºæœ¬ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  basic_metrics <- data |>
    metrics(truth = !!sym(truth_col), 
            estimate = !!sym(pred_col),
            !!sym(pred_prob_col))
  
  # æ··åŒè¡Œåˆ—
  conf_matrix <- data |>
    conf_mat(truth = !!sym(truth_col), estimate = !!sym(pred_col))
  
  # ROC & PRæ›²ç·šãƒ‡ãƒ¼ã‚¿
  roc_data <- data |>
    roc_curve(truth = !!sym(truth_col), !!sym(pred_prob_col))
  
  pr_data <- data |>
    pr_curve(truth = !!sym(truth_col), !!sym(pred_prob_col))
  
  # çµæœã‚’ãƒªã‚¹ãƒˆã§è¿”ã™
  list(
    basic_stats = basic_stats,
    metrics = basic_metrics,
    confusion_matrix = conf_matrix,
    roc_curve = roc_data,
    pr_curve = pr_data
  )
}

# ä½¿ç”¨ä¾‹
evaluation_report <- comprehensive_evaluation(
  classification_sample,
  "truth",
  "estimate", 
  ".pred_Class1"
)

# ãƒ¬ãƒãƒ¼ãƒˆã®è¡¨ç¤º
evaluation_report$basic_stats
evaluation_report$metrics
</pre>

            <h3>2. å¯è¦–åŒ–ä»˜ããƒ¬ãƒãƒ¼ãƒˆ</h3>
            <pre>
# å¯è¦–åŒ–é–¢æ•°
create_evaluation_plots <- function(eval_report) {
  # ROCæ›²ç·š
  roc_plot <- eval_report$roc_curve |>
    ggplot(aes(x = 1 - specificity, y = sensitivity)) +
    geom_line(size = 1.2, color = "blue") +
    geom_abline(slope = 1, intercept = 0, linetype = "dashed") +
    coord_equal() +
    labs(title = "ROC Curve", x = "FPR", y = "TPR") +
    theme_minimal()
  
  # PRæ›²ç·š
  pr_plot <- eval_report$pr_curve |>
    ggplot(aes(x = recall, y = precision)) +
    geom_line(size = 1.2, color = "green") +
    labs(title = "Precision-Recall Curve") +
    theme_minimal()
  
  # æ··åŒè¡Œåˆ—
  conf_plot <- autoplot(eval_report$confusion_matrix, type = "heatmap") +
    scale_fill_gradient(low = "white", high = "lightblue") +
    labs(title = "Confusion Matrix") +
    theme_minimal()
  
  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ£’ã‚°ãƒ©ãƒ•
  metrics_plot <- eval_report$metrics |>
    filter(.metric %in% c("accuracy", "precision", "recall", "f_meas")) |>
    ggplot(aes(x = .metric, y = .estimate)) +
    geom_col(fill = "lightcoral") +
    geom_text(aes(label = round(.estimate, 3)), vjust = -0.3) +
    ylim(0, 1) +
    labs(title = "Key Metrics", x = "Metric", y = "Value") +
    theme_minimal()
  
  # 4ã¤ã®ãƒ—ãƒ­ãƒƒãƒˆã‚’çµ„ã¿åˆã‚ã›
  library(patchwork)
  (roc_plot + pr_plot) / (conf_plot + metrics_plot)
}

# å¯è¦–åŒ–å®Ÿè¡Œ
evaluation_plots <- create_evaluation_plots(evaluation_report)
evaluation_plots
</pre>
        </div>

        <!-- EVALUATION STRATEGIES -->
        <div class="section">
            <h2>ğŸ¯ è©•ä¾¡æˆ¦ç•¥ã®é¸æŠæŒ‡é‡</h2>
            <p>
                ç•°ãªã‚‹å•é¡Œã‚¿ã‚¤ãƒ—ã‚„ãƒ‡ãƒ¼ã‚¿ã®æ€§è³ªã«å¿œã˜ãŸæœ€é©ãªè©•ä¾¡æˆ¦ç•¥ã‚’é¸æŠã—ã¾ã—ã‚‡ã†ã€‚
            </p>
            
            <div class="function-grid">
                <div class="function-card">
                    <div class="function-title">ğŸ“Š å›å¸°å•é¡Œ</div>
                    <div class="function-description">
                        <strong>ä¸»è¦æŒ‡æ¨™:</strong> RMSE, MAE, RÂ²<br>
                        <strong>é¸æŠæŒ‡é‡:</strong> RMSEï¼ˆè§£é‡ˆã—ã‚„ã™ã„ï¼‰ã€MAEï¼ˆå¤–ã‚Œå€¤ã«é ‘å¥ï¼‰<br>
                        <strong>æ³¨æ„ç‚¹:</strong> ã‚¹ã‚±ãƒ¼ãƒ«ã‚„åˆ†å¸ƒã‚’è€ƒæ…®
                    </div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">âš–ï¸ ãƒãƒ©ãƒ³ã‚¹åˆ†é¡</div>
                    <div class="function-description">
                        <strong>ä¸»è¦æŒ‡æ¨™:</strong> Accuracy, F1-score<br>
                        <strong>é©ç”¨ã‚±ãƒ¼ã‚¹:</strong> å„ã‚¯ãƒ©ã‚¹ã®ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒåŒç¨‹åº¦<br>
                        <strong>å¯è¦–åŒ–:</strong> ROCæ›²ç·šãŒåŠ¹æœçš„
                    </div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">âš ï¸ ä¸å‡è¡¡åˆ†é¡</div>
                    <div class="function-description">
                        <strong>ä¸»è¦æŒ‡æ¨™:</strong> Precision, Recall, PR-AUC<br>
                        <strong>é©ç”¨ã‚±ãƒ¼ã‚¹:</strong> é™£æ€§ã‚µãƒ³ãƒ—ãƒ«ãŒå°‘ãªã„å ´åˆ<br>
                        <strong>å¯è¦–åŒ–:</strong> PRæ›²ç·šã‚’å„ªå…ˆ
                    </div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">ğŸ¢ ãƒ“ã‚¸ãƒã‚¹æŒ‡æ¨™</div>
                    <div class="function-description">
                        <strong>ä¸»è¦æŒ‡æ¨™:</strong> ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªãƒƒã‚¯<br>
                        <strong>é©ç”¨ã‚±ãƒ¼ã‚¹:</strong> ã‚³ã‚¹ãƒˆè€ƒæ…®ã€ROIé‡è¦–<br>
                        <strong>ç‰¹å¾´:</strong> ãƒ“ã‚¸ãƒã‚¹è¦ä»¶ã‚’ç›´æ¥åæ˜ 
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ† ç« ã®ã¾ã¨ã‚</h2>
            <p>
                æœ¬ç« ã§ã¯ã€yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸåŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡æŠ€è¡“ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸã€‚å®Ÿç”¨çš„ãªæ©Ÿæ¢°å­¦ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®è©•ä¾¡æŠ€è¡“ã‚’ç¿’å¾—ã—ã¾ã—ãŸã€‚
            </p>
            
            <h3>ğŸ“š å­¦ç¿’ã—ãŸä¸»è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            <div class="function-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <div class="function-card">
                    <div class="function-title">åŸºæœ¬è©•ä¾¡</div>
                    <div class="function-description">
                        â€¢ yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®çµ±ä¸€API<br>
                        â€¢ å›å¸°ãƒ»åˆ†é¡æŒ‡æ¨™ã®ç†è§£<br>
                        â€¢ metrics()é–¢æ•°ã§ä¸€æ‹¬è©•ä¾¡
                    </div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">é«˜åº¦ãªå¯è¦–åŒ–</div>
                    <div class="function-description">
                        â€¢ ROCæ›²ç·šã¨PRæ›²ç·šã®ä½œæˆ<br>
                        â€¢ æ··åŒè¡Œåˆ—ã®ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—<br>
                        â€¢ autoplot()ã§ç°¡å˜å¯è¦–åŒ–
                    </div>
                </div>
                
                <div class="function-card">
                    <div class="function-title">å®Ÿç”¨çš„ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</div>
                    <div class="function-description">
                        â€¢ é—¾å€¤æœ€é©åŒ–æ‰‹æ³•<br>
                        â€¢ ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªãƒƒã‚¯ä½œæˆ<br>
                        â€¢ è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </div>
                </div>
            </div>
            
            <p style="margin-top: 30px; font-size: 1.1rem; color: var(--accent-neon); text-align: center;">
                ğŸš€ <strong>ã“ã‚Œã§ã‚ãªãŸã‚‚ãƒ¢ãƒ‡ãƒ«è©•ä¾¡ã®ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã™ï¼</strong>
            </p>
        </div>

        <!-- LEGACY SECTION - keeping for reference -->
        <div class="section" style="display:none;">
            <h2>ğŸ¯ ã¾ã¨ã‚ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>
            
            <h3>Chapter 18ã§å­¦ã‚“ã ã“ã¨</h3>
            <ul>
                <li>yardstickãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ãªãƒ¢ãƒ‡ãƒ«è©•ä¾¡</li>
                <li>å›å¸°ãƒ»åˆ†é¡å•é¡Œãã‚Œãã‚Œã®é‡è¦ãªè©•ä¾¡æŒ‡æ¨™</li>
                <li>å¤šã‚¯ãƒ©ã‚¹åˆ†é¡ã®ç‰¹æ®Šãªè©•ä¾¡æ‰‹æ³•</li>
                <li>ROCãƒ»PRæ›²ç·šã«ã‚ˆã‚‹æ€§èƒ½ã®å¯è¦–åŒ–</li>
                <li>æœ€é©é–¾å€¤ã®æ±ºå®šæ–¹æ³•</li>
                <li>ã‚«ã‚¹ã‚¿ãƒ è©•ä¾¡æŒ‡æ¨™ã®ä½œæˆ</li>
                <li>åŒ…æ‹¬çš„ãªè©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ</li>
            </ul>

            <h3>è©•ä¾¡æŒ‡æ¨™é¸æŠã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</h3>
            <div class="tip-box">
                <ul>
                    <li><strong>å›å¸°å•é¡Œ</strong>: RMSEï¼ˆè§£é‡ˆã—ã‚„ã™ã„ï¼‰ã€MAEï¼ˆå¤–ã‚Œå€¤ã«é ‘å¥ï¼‰</li>
                    <li><strong>ãƒãƒ©ãƒ³ã‚¹åˆ†é¡</strong>: Accuracyã€F1-score</li>
                    <li><strong>ä¸å‡è¡¡åˆ†é¡</strong>: Precisionã€Recallã€PR-AUC</li>
                    <li><strong>ã‚³ã‚¹ãƒˆè€ƒæ…®</strong>: ã‚«ã‚¹ã‚¿ãƒ æŒ‡æ¨™ï¼ˆãƒ“ã‚¸ãƒã‚¹è¦ä»¶åæ˜ ï¼‰</li>
                </ul>
            </div>

            <div class="warning-box">
                <p><strong>è©•ä¾¡ã®æ³¨æ„ç‚¹ï¼š</strong></p>
                <ul>
                    <li>å˜ä¸€æŒ‡æ¨™ã ã‘ã§ãªãè¤‡æ•°ã®è¦³ç‚¹ã‹ã‚‰è©•ä¾¡ã™ã‚‹</li>
                    <li>ãƒ‡ãƒ¼ã‚¿ã®æ€§è³ªï¼ˆä¸å‡è¡¡ã€å¤–ã‚Œå€¤ç­‰ï¼‰ã‚’è€ƒæ…®ã™ã‚‹</li>
                    <li>ãƒ“ã‚¸ãƒã‚¹ç›®æ¨™ã¨æŠ€è¡“çš„æŒ‡æ¨™ã‚’æ•´åˆã•ã›ã‚‹</li>
                    <li>äº¤å·®æ¤œè¨¼ã§ã®å®‰å®šæ€§ã‚‚ç¢ºèªã™ã‚‹</li>
                </ul>
            </div>

            <h3>æ¬¡ã®ç« ã¸ã®æº–å‚™</h3>
            <p>æ¬¡ã®ç¬¬19ç« ã§ã¯ã€è©•ä¾¡æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ãŸ<strong>äºˆæ¸¬ã¨è§£é‡ˆ</strong>ã‚’å­¦ç¿’ã—ã¾ã™ã€‚å®Ÿéš›ã®äºˆæ¸¬ã‚¿ã‚¹ã‚¯ã§ã®æ´»ç”¨æ–¹æ³•ã¨ã€ãƒ¢ãƒ‡ãƒ«ã®è§£é‡ˆå¯èƒ½æ€§ã«ã¤ã„ã¦æ·±ãç†è§£ã—ã¾ã—ã‚‡ã†ã€‚</p>
        </div>

        <!-- Bottom Navigation -->
        <nav class="chapter-nav" style="margin-top: 40px;">
            <a href="chapter10-advanced-dplyr.html" class="nav-button">Ch10: dplyrå¿œç”¨</a>
            <a href="chapter11-machine-learning.html" class="nav-button">Ch11: æ©Ÿæ¢°å­¦ç¿’</a>
            <a href="chapter12-model-evaluation.html" class="nav-button">Ch12: ãƒ¢ãƒ‡ãƒ«è©•ä¾¡</a>
            <a href="chapter13-advanced-ggplot2.html" class="nav-button">Ch13: ggplot2å¿œç”¨</a>
            <a href="chapter14-interactive-visualization.html" class="nav-button">Ch14: å¯¾è©±çš„å¯è¦–åŒ–</a>
            <a href="chapter15-big-data.html" class="nav-button">Ch15: ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿</a>
            <a href="chapter16-resampling-rsample.html" class="nav-button">Ch16: ãƒªã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°</a>
            <a href="chapter17-hyperparameter-tuning.html" class="nav-button">Ch17: ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°</a>
            <a href="chapter18-model-evaluation-yardstick.html" class="nav-button current">Ch18: ãƒ¢ãƒ‡ãƒ«è©•ä¾¡</a>
            <a href="chapter19-prediction-interpretation.html" class="nav-button">Ch19: äºˆæ¸¬è§£é‡ˆ</a>
            <a href="chapter20-best-practices.html" class="nav-button">Ch20: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</a>
        </nav>

    <!-- å­¦ç¿’ã«ãŠã™ã™ã‚ã®æ›¸ç± -->
    <section class="book-recommendations" style="margin: 4rem 0; padding: 2rem; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; backdrop-filter: blur(10px);">
        <div class="container">
            <h3 style="color: var(--neon-cyan); font-family: var(--font-tech); font-size: 1.8rem; margin-bottom: 2rem; text-align: center;">
                ğŸ“š å­¦ç¿’ã«ãŠã™ã™ã‚ã®æ›¸ç±
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;">
                
                <!-- Book 1 -->
                <div class="book-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <a href="https://amzn.to/48d9vpc" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
                        <div style="display: flex; flex-direction: column; height: 100%;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--neon-lime); font-size: 1.2rem; margin-bottom: 1rem; font-family: var(--font-tech);">
                                    ğŸ”¥ Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®RStudio[å®Ÿè·µ]å…¥é–€
                                </h4>
                                <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem;">
                                    tidyverseã®åŸºç¤ã‹ã‚‰å®Ÿè·µã¾ã§ç¶²ç¾…ã—ãŸæ—¥æœ¬èªæ±ºå®šç‰ˆã€‚RStudioã¨tidyverseã§ãƒ‡ãƒ¼ã‚¿åˆ†æã‚’ãƒã‚¹ã‚¿ãƒ¼ã€‚
                                </p>
                            </div>
                            <div style="background: var(--gradient-cyber); color: var(--void-black); padding: 0.8rem 1.5rem; border-radius: 25px; text-align: center; font-weight: 600; font-family: var(--font-tech); margin-top: auto;">
                                Amazonã§è©³ç´°ã‚’è¦‹ã‚‹ â†’
                            </div>
                        </div>
                    </a>
                </div>
                
                <!-- Book 2 -->
                <div class="book-card" style="background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 15px; padding: 1.5rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <a href="https://amzn.to/3IfcanU" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">
                        <div style="display: flex; flex-direction: column; height: 100%;">
                            <div style="flex: 1;">
                                <h4 style="color: var(--neon-magenta); font-size: 1.2rem; margin-bottom: 1rem; font-family: var(--font-tech);">
                                    ğŸ¤– Rãƒ¦ãƒ¼ã‚¶ã®ãŸã‚ã®tidymodels[å®Ÿè·µ]å…¥é–€
                                </h4>
                                <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem;">
                                    tidymodelsã§æ©Ÿæ¢°å­¦ç¿’ã‚’å®Ÿè·µã™ã‚‹ãŸã‚ã®æ—¥æœ¬èªã‚¬ã‚¤ãƒ‰ã€‚ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ã‹ã‚‰è©•ä¾¡ã¾ã§å®Œå…¨ç¶²ç¾…ã€‚
                                </p>
                            </div>
                            <div style="background: var(--gradient-plasma); color: white; padding: 0.8rem 1.5rem; border-radius: 25px; text-align: center; font-weight: 600; font-family: var(--font-tech); margin-top: auto;">
                                Amazonã§è©³ç´°ã‚’è¦‹ã‚‹ â†’
                            </div>
                        </div>
                    </a>
                </div>
                
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; font-style: italic;">
                    â€» å½“ã‚µã‚¤ãƒˆã¯Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã™
                </p>
            </div>
        </div>
    </section>
    
    <style>
    .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        border-color: var(--neon-cyan);
    }

    .book-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s ease;
    }

    .book-card:hover::before {
        left: 100%;
    }
    </style>

    </div>
</body>
</html>